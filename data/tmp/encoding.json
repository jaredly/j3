{"map":{"0":{"type":"rich-text","contents":[{"id":"2bd04b0b-8d31-4577-b1a3-05b553f9e692","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":2},"content":[{"type":"text","text":"A Runtime Encoding","styles":{}}],"children":[]},{"id":"7fa8462a-6fcd-4241-92e7-47889e0a8fcf","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"that's very \"simple\".","styles":{}}],"children":[]},{"id":"19d55d25-6a79-408f-a2cd-abea846f07be","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"Values are:","styles":{}}],"children":[]},{"id":"a55b9c1a-07e4-454f-8c9f-7b2fe262bd13","type":"bulletListItem","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"primitives (string, int, bool)","styles":{}}],"children":[]},{"id":"74137d8f-e03f-4bdb-8768-b7b4859d498f","type":"bulletListItem","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"variants, of the form ","styles":{}},{"type":"text","text":"{type: \"name\", 0: arg1, 1: arg2, ...}","styles":{"code":true}}],"children":[]},{"id":"bf773d82-040a-4e76-acf0-efc06e8c6411","type":"bulletListItem","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"functions, which don't (currently) support serialization","styles":{}}],"children":[]},{"id":"6fbb3aa9-9aaf-4ddc-b360-783633818c79","type":"bulletListItem","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"...and that's it! lists are made of cons & nil","styles":{}}],"children":[]}],"loc":0},"3":{"loc":3,"type":"raw-code","lang":"javascript","raw":"valueToString = (v) => {\n    if (Array.isArray(v)) {\n        return `[${v.map(valueToString).join(', ')}]`;\n    }\n\n    if (typeof v === 'object' && v && 'type' in v) {\n        if (v.type === 'cons' || v.type === 'nil') {\n            const un = unwrapArray(v);\n            return '[' + un.map(valueToString).join(' ') + ']';\n        }\n\n        let args = [];\n        for (let i = 0; i in v; i++) {\n            args.push(v[i]);\n        }\n        return `(${v.type}${args\n            .map((arg) => ' ' + valueToString(arg))\n            .join('')})`;\n    }\n    if (typeof v === 'string') {\n        if (v.includes('\"') && !v.includes(\"'\")) {\n            return (\n                \"'\" + JSON.stringify(v).slice(1, -1).replace(/\\\\\"/g, '\"') + \"'\"\n            );\n        }\n        return JSON.stringify(v);\n    }\n    if (typeof v === 'function') {\n        return '<function>';\n    }\n\n    return '' + v;\n};\n"},"5":{"loc":5,"type":"raw-code","lang":"javascript","raw":"valueToNode = (v) => {\n  if (typeof v === 'object' && v && 'type' in v) {\n    if (v.type === 'cons' || v.type === 'nil') {\n      const un = unwrapArray(v)\n      return {type: 'array', values: un.map(valueToNode), loc: -1}\n    }\n    let args = [];\n    for (let i=0; i in v; i++) {\n      args.push(v[i]);\n    }\n    return {type: 'list', values: [{type: 'identifier', text: v.type, loc: -1}, ...args.map(valueToNode)], loc: -1}\n  }\n  if (typeof v === 'string') {\n    return {type: 'string', first: {type: 'stringText', text: v, loc: -1}, templates: [], loc: -1}\n  }\n  if (typeof v === 'number' || typeof v === 'boolean') {\n    return {type: 'identifier', text: v + '', loc: -1}\n  }\n  return null \n}\n"},"7":{"type":"raw-code","lang":"javascript","raw":"({valueToString, valueToNode})","loc":7},"11":{"loc":11,"type":"raw-code","lang":"javascript","raw":"unwrapArray = value => value.type === 'nil' ? [] : [value[0], ...unwrapArray(value[1])]"},"-1":{"type":"list","values":[0],"loc":-1}},"root":-1,"meta":{},"history":[{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":1,"idx":0},{"type":"ns-top","idx":1},{"idx":0,"type":"subtext","at":0}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":1,"idx":0},{"type":"ns-top","idx":1},{"idx":0,"type":"subtext","at":0}]}],"prev":{"3":null},"meta":{},"metaPrev":{},"map":{"3":{"loc":3,"type":"raw-code","lang":"javascript","raw":"valueToString = (v) => {\n    if (Array.isArray(v)) {\n        return `[${v.map(valueToString).join(', ')}]`;\n    }\n\n    if (typeof v === 'object' && v && 'type' in v) {\n        if (v.type === 'cons' || v.type === 'nil') {\n            const un = unwrapArray(v);\n            return '[' + un.map(valueToString).join(' ') + ']';\n        }\n\n        let args = [];\n        for (let i = 0; i in v; i++) {\n            args.push(v[i]);\n        }\n        return `(${v.type}${args\n            .map((arg) => ' ' + valueToString(arg))\n            .join('')})`;\n    }\n    if (typeof v === 'string') {\n        if (v.includes('\"') && !v.includes(\"'\")) {\n            return (\n                \"'\" + JSON.stringify(v).slice(1, -1).replace(/\\\\\"/g, '\"') + \"'\"\n            );\n        }\n        return JSON.stringify(v);\n    }\n    if (typeof v === 'function') {\n        return '<function>';\n    }\n\n    return '' + v;\n};\n"}},"nsMap":{"0":{"id":0,"top":-1,"children":[1,2],"type":"normal"},"2":{"type":"normal","id":2,"top":3,"children":[]}},"nsPrev":{"0":{"id":0,"top":-1,"children":[1],"type":"normal"},"2":null},"id":0,"ts":1714669198.397,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":1,"idx":0},{"type":"ns-top","idx":1},{"idx":0,"type":"subtext","at":0}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":1,"idx":0},{"type":"ns-top","idx":1},{"idx":0,"type":"subtext","at":0}]}],"prev":{"5":null},"meta":{},"metaPrev":{},"map":{"5":{"loc":5,"type":"raw-code","lang":"javascript","raw":"valueToNode = (v) => {\n  if (typeof v === 'object' && v && 'type' in v) {\n    if (v.type === 'cons' || v.type === 'nil') {\n      const un = unwrapArray(v)\n      return {type: 'array', values: un.map(valueToNode), loc: -1}\n    }\n    let args = [];\n    for (let i=0; i in v; i++) {\n      args.push(v[i]);\n    }\n    return {type: 'list', values: [{type: 'identifier', text: v.type, loc: -1}, ...args.map(valueToNode)], loc: -1}\n  }\n  if (typeof v === 'string') {\n    return {type: 'string', first: {type: 'stringText', text: v, loc: -1}, templates: [], loc: -1}\n  }\n  if (typeof v === 'number' || typeof v === 'boolean') {\n    return {type: 'identifier', text: v + '', loc: -1}\n  }\n  return null \n}\n"}},"nsMap":{"0":{"id":0,"top":-1,"children":[1,4,2],"type":"normal"},"4":{"type":"normal","id":4,"top":5,"children":[]}},"nsPrev":{"0":{"id":0,"top":-1,"children":[1,2],"type":"normal"},"4":null},"id":1,"ts":1714669202.144,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":2,"idx":0},{"type":"ns-top","idx":2},{"idx":3,"type":"end"}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":2,"idx":0},{"type":"ns-top","idx":2},{"idx":3,"type":"end"}]}],"prev":{"7":null},"meta":{},"metaPrev":{},"map":{"7":{"loc":7,"type":"raw-code","lang":"javascript","raw":"({fromNode, toNode, valueToString, valueToNode})"}},"nsMap":{"0":{"id":0,"top":-1,"children":[1,4,2,6],"type":"normal"},"6":{"type":"normal","id":6,"top":7,"children":[]}},"nsPrev":{"0":{"id":0,"top":-1,"children":[1,4,2],"type":"normal"},"6":null},"id":2,"ts":1714669210.089,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":6,"idx":0},{"type":"ns-top","idx":6},{"idx":7,"type":"start"}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":6,"idx":0},{"type":"ns-top","idx":6},{"idx":7,"type":"start"}]}],"prev":{},"meta":{},"metaPrev":{},"map":{},"nsMap":{"6":{"type":"normal","id":6,"top":7,"children":[],"plugin":{"id":"evaluator","options":null}}},"nsPrev":{"6":{"type":"normal","id":6,"top":7,"children":[]}},"id":3,"ts":1714669215.273,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":6,"idx":0},{"type":"ns-top","idx":6},{"type":"rich-text","idx":7,"sel":null}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":6,"idx":0},{"type":"ns-top","idx":6},{"type":"rich-text","idx":7,"sel":null}],"end":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":6,"idx":0},{"type":"ns-top","idx":6},{"idx":7,"type":"end"}]}],"prev":{"7":{"loc":7,"type":"raw-code","lang":"javascript","raw":"({fromNode, toNode, valueToString, valueToNode})"}},"meta":{},"metaPrev":{},"map":{"7":{"type":"raw-code","lang":"javascript","raw":"({valueToString, valueToNode})","loc":7}},"nsMap":{},"nsPrev":{},"id":4,"ts":1714669219.159,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":1,"idx":0},{"type":"ns-top","idx":1},{"type":"rich-text","idx":0,"sel":"2bd04b0b-8d31-4577-b1a3-05b553f9e692"}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":1,"idx":0},{"type":"ns-top","idx":1},{"idx":0,"type":"subtext","at":0}]}],"prev":{"0":{"type":"blank","loc":0}},"meta":{},"metaPrev":{},"map":{"0":{"type":"rich-text","contents":[{"id":"2bd04b0b-8d31-4577-b1a3-05b553f9e692","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":2},"content":[{"type":"text","text":"A Runtime Encoding","styles":{}}],"children":[]},{"id":"7fa8462a-6fcd-4241-92e7-47889e0a8fcf","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"that's very \"simple\".","styles":{}}],"children":[]},{"id":"19d55d25-6a79-408f-a2cd-abea846f07be","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"Values are:","styles":{}}],"children":[]},{"id":"a55b9c1a-07e4-454f-8c9f-7b2fe262bd13","type":"bulletListItem","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"primitives (string, int, bool)","styles":{}}],"children":[]},{"id":"74137d8f-e03f-4bdb-8768-b7b4859d498f","type":"bulletListItem","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"variants, of the form ","styles":{}},{"type":"text","text":"{type: \"name\", 0: arg1, 1: arg2, ...}","styles":{"code":true}}],"children":[]},{"id":"bf773d82-040a-4e76-acf0-efc06e8c6411","type":"bulletListItem","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"functions, which don't (currently) support serialization","styles":{}}],"children":[]},{"id":"6fbb3aa9-9aaf-4ddc-b360-783633818c79","type":"bulletListItem","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"...and that's it! lists are made of cons & nil","styles":{}}],"children":[]}],"loc":0}},"nsMap":{},"nsPrev":{},"id":5,"ts":1714669226.14,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":9,"idx":0},{"type":"ns-top","idx":9},{"idx":8,"type":"start"}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":2,"idx":0},{"type":"ns-top","idx":2},{"idx":3,"type":"end"}]}],"prev":{"8":null},"meta":{},"metaPrev":{},"map":{"8":{"type":"blank","loc":8}},"nsMap":{"0":{"id":0,"top":-1,"children":[1,4,2,9,6],"type":"normal"},"9":{"type":"normal","top":8,"children":[],"id":9}},"nsPrev":{"0":{"id":0,"top":-1,"children":[1,4,2,6],"type":"normal"},"9":null},"id":6,"ts":1714669415.284,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":9,"idx":0},{"type":"ns-top","idx":9},{"idx":8,"type":"start"}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":9,"idx":0},{"type":"ns-top","idx":9},{"idx":8,"type":"start"}]}],"prev":{"11":null,"13":null},"meta":{},"metaPrev":{},"map":{"11":{"loc":11,"type":"raw-code","lang":"javascript","raw":"unwrapArray = value => value.type === 'nil' ? [] : [value[0], ...unwrapArray(value[1])]"},"13":{"loc":13,"type":"raw-code","lang":"javascript","raw":"unwrapArray(arr([1,2,3]))"}},"nsMap":{"0":{"id":0,"top":-1,"children":[1,4,2,9,10,6],"type":"normal"},"10":{"type":"normal","id":10,"top":11,"children":[12]},"12":{"type":"normal","id":12,"top":13,"children":[]}},"nsPrev":{"0":{"id":0,"top":-1,"children":[1,4,2,9,6],"type":"normal"},"10":null,"12":null},"id":7,"ts":1714669415.641,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":2,"idx":0},{"type":"ns-top","idx":2},{"idx":3,"type":"end"}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":9,"idx":0},{"type":"ns-top","idx":9},{"idx":8,"type":"subtext","at":0}]}],"prev":{"8":{"type":"blank","loc":8}},"meta":{},"metaPrev":{},"map":{"8":null},"nsMap":{"0":{"id":0,"top":-1,"children":[1,4,2,10,6],"type":"normal"},"9":null},"nsPrev":{"0":{"id":0,"top":-1,"children":[1,4,2,9,10,6],"type":"normal"},"9":{"type":"normal","top":8,"children":[],"id":9}},"id":8,"ts":1714669417.412,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":10,"idx":0},{"type":"ns","child":12,"idx":10},{"type":"ns-top","idx":12},{"idx":13,"type":"start"}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":10,"idx":0},{"type":"ns","child":12,"idx":10},{"type":"ns-top","idx":12},{"idx":13,"type":"end"}]}],"prev":{"13":{"loc":13,"type":"raw-code","lang":"javascript","raw":"unwrapArray(arr([1,2,3]))"}},"meta":{},"metaPrev":{},"map":{"13":{"type":"blank","loc":13}},"nsMap":{"12":{"type":"normal","id":12,"top":13,"children":[]}},"nsPrev":{"12":{"type":"normal","id":12,"top":13,"children":[]}},"id":9,"ts":1714669420.607,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":2,"idx":0},{"type":"ns-top","idx":2},{"idx":3,"type":"end"}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":10,"idx":0},{"type":"ns","child":12,"idx":10},{"type":"ns-top","idx":12},{"idx":13,"type":"start"}]}],"prev":{"13":{"type":"blank","loc":13}},"meta":{},"metaPrev":{},"map":{"13":null},"nsMap":{"10":{"type":"normal","id":10,"top":11,"children":[]},"12":null},"nsPrev":{"10":{"type":"normal","id":10,"top":11,"children":[12]},"12":{"type":"normal","id":12,"top":13,"children":[]}},"id":10,"ts":1714669421.182,"libraryRoot":""},{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":2,"idx":0},{"type":"ns-top","idx":2},{"idx":3,"type":"end"}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":2,"idx":0},{"type":"ns-top","idx":2},{"idx":3,"type":"end"}]}],"prev":{},"meta":{},"metaPrev":{},"map":{},"nsMap":{"6":{"type":"normal","id":6,"top":7,"children":[],"plugin":{"id":"evaluator","options":"encoding.js"}}},"nsPrev":{"6":{"type":"normal","id":6,"top":7,"children":[],"plugin":{"id":"evaluator","options":null}}},"id":11,"ts":1714669431.343,"libraryRoot":""}],"clipboard":[],"hover":[],"regs":{},"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":2,"idx":0},{"type":"ns-top","idx":2},{"idx":3,"type":"end"}]}],"cards":[{"path":[],"top":0}],"nsMap":{"0":{"id":0,"top":-1,"children":[1,4,2,10,6],"type":"normal"},"1":{"id":1,"top":0,"children":[],"type":"normal"},"2":{"type":"normal","id":2,"top":3,"children":[]},"4":{"type":"normal","id":4,"top":5,"children":[]},"6":{"type":"normal","id":6,"top":7,"children":[],"plugin":{"id":"evaluator","options":"encoding.js"}},"10":{"type":"normal","id":10,"top":11,"children":[]}},"highlight":[],"evaluator":":js:"}