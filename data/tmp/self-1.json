{"collapse":{"403":false,"408":false,"529":false,"541":false,"590":false,"618":false,"2598":false},"root":-1,"history":[{"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":6561,"idx":3465},{"type":"ns","child":6563,"idx":6561},{"type":"ns-top","idx":6563},{"idx":6565,"type":"child","at":2},{"type":"rich-text","idx":6564,"sel":null}]}],"prevAt":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":6561,"idx":3465},{"type":"ns","child":6563,"idx":6561},{"type":"ns-top","idx":6563},{"idx":6565,"type":"child","at":2},{"type":"rich-text","idx":6564,"sel":null}]}],"prev":{"6564":{"type":"raw-code","lang":"javascript","raw":"function equal(a, b) {\n    if (a === b) return true;\n\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\n        var length, i, keys;\n        if (Array.isArray(a)) {\n            length = a.length;\n            if (length != b.length) return false;\n            for (i = length; i-- !== 0; ) if (!equal(a[i], b[i])) return false;\n            return true;\n        }\n\n        keys = Object.keys(a);\n        length = keys.length;\n        if (length !== Object.keys(b).length) return false;\n\n        for (i = length; i-- !== 0; ) {\n            if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n        }\n\n        for (i = length; i-- !== 0; ) {\n            var key = keys[i];\n\n            if (!equal(a[key], b[key])) return false;\n        }\n\n        return true;\n    }\n\n    // true if both NaN, false otherwise\n    return a !== a && b !== b;\n}\n\nfunction unescapeString(n) {\n    if (n == null || !n.replaceAll) {\n        debugger;\n        return '';\n    }\n    return n.replaceAll(/\\\\\\\\./g, (m) => {\n        if (m[1] === 'n') {\n            return '\\\\n';\n        }\n        if (m[1] === 't') {\n            return '\\\\t';\n        }\n        if (m[1] === 'r') {\n            return '\\\\r';\n        }\n        return m[1];\n    });\n}\n\nfunction unwrapList(v) {\n    return v.type === 'nil' ? [] : [v[0], ...unwrapList(v[1])];\n}\n\nfunction wrapList(v) {\n    let res = { type: 'nil' };\n    for (let i = v.length - 1; i >= 0; i--) {\n        res = { type: 'cons', 0: v[i], 1: res };\n    }\n    return res;\n}\n\nconst sanMap = {\n    // '$$$$' gets interpreted by replaceAll as '$$', for reasons\n    $: '$$$$',\n    '-': '_',\n    '+': '$pl',\n    '*': '$ti',\n    '=': '$eq',\n    '>': '$gt',\n    '<': '$lt',\n    \"'\": '$qu',\n    '\"': '$dq',\n    ',': '$co',\n    '/': '$sl',\n    ';': '$semi',\n    '@': '$at',\n    ':': '$cl',\n    '#': '$ha',\n    '!': '$ex',\n    '|': '$bar',\n    '()': '$unit',\n    '?': '$qe',\n  };\nconst kwds =\n    'case new var const let if else return super break while for default eval'.split(' ');\n\n// Convert an identifier into a valid js identifier, replacing special characters, and accounting for keywords.\nfunction sanitize(raw) {\n    for (let [key, val] of Object.entries(sanMap)) {\n        raw = raw.replaceAll(key, val);\n    }\n    if (kwds.includes(raw)) return '$' + raw\n    return raw\n}\n\nconst valueToString = (v) => {\n    if (Array.isArray(v)) {\n        return `[${v.map(valueToString).join(', ')}]`;\n    }\n    if (typeof v === 'object' && v && 'type' in v) {\n        if (v.type === 'cons' || v.type === 'nil') {\n            const un = unwrapList(v);\n            return '[' + un.map(valueToString).join(' ') + ']';\n        }\n\n        let args = [];\n        for (let i = 0; i in v; i++) {\n            args.push(v[i]);\n        }\n        return `(${v.type}${args\n            .map((arg) => ' ' + valueToString(arg))\n            .join('')})`;\n    }\n    if (typeof v === 'string') {\n        if (v.includes('\"') && !v.includes(\"'\")) {\n            return (\n                \"'\" + JSON.stringify(v).slice(1, -1).replace(/\\\\\"/g, '\"') + \"'\"\n            );\n        }\n        return JSON.stringify(v);\n    }\n    if (typeof v === 'function') {\n        return '<function>';\n    }\n\n    return '' + v;\n};\n\nreturn {\n    '+': (a) => (b) => a + b,\n    '-': (a) => (b) => a - b,\n    '<': (a) => (b) => a < b,\n    '<=': (a) => (b) => a <= b,\n    '>': (a) => (b) => a > b,\n    '>=': (a) => (b) => a >= b,\n    '=': (a) => (b) => equal(a, b),\n    '!=': (a) => (b) => !equal(a, b),\n    pi: Math.PI,\n    'replace-all': a => b => c => a.replaceAll(b, c),\n    eval: source => {\n      return new Function('', 'return ' + source)();\n    },\n    'eval-with': ctx => source => {\n      const args = '{' + Object.keys(ctx).join(',') + '}'\n      return new Function(args, 'return ' + source)(ctx);\n    },\n    $unit: null,\n    errorToString: f => arg => {\n      try {\n        return f(arg)\n      } catch (err) {\n        return err.message;\n      }\n    },\n    valueToString,\n    unescapeString,\n    sanitize,\n    equal: a => b => equal(a, b),\n    'int-to-string': (a) => a.toString(),\n    'float-to-string': a => a.toString(),\n    'string-to-int': (a) => {\n        const v = Number(a);\n        return Number.isInteger(v) && v.toString() === a ? { type: 'some', 0: v } : { type: 'none' };\n    },\n    'string-to-float': (a) => {\n        const v = Number(a);\n        return Number.isFinite(v) ? { type: 'some', 0: v } : { type: 'none' };\n    },\n\n    // maps\n    'map/nil': [],\n    'map/set': (map) => (key) => (value) =>\n        [[key, value], ...map.filter((i) => i[0] !== key)],\n    'map/rm': (map) => (key) => map.filter((i) => !equal(i[0], key)),\n    'map/get': (map) => (key) => {\n        const found = map.find((i) => equal(i[0], key));\n        return found ? { type: 'some', 0: found[1] } : { type: 'none' };\n    },\n    'map/map': (fn) => (map) => map.map(([k, v]) => [k, fn(v)]),\n    'map/merge': (one) => (two) =>\n        [...one, ...two.filter(([key]) => !one.find(([a]) => equal(a, key)))],\n    'map/values': (map) => wrapList(map.map((item) => item[1])),\n    'map/keys': (map) => wrapList(map.map((item) => item[0])),\n    'map/from-list': (list) =>\n        unwrapList(list).map((pair) => [pair[0], pair[1]]),\n    'map/to-list': (map) =>\n        wrapList(map.map(([key, value]) => ({ type: ',', 0: key, 1: value }))),\n\n    // sets\n    'set/nil': [],\n    'set/add': (s) => (v) => [v, ...s.filter((m) => !equal(v, m))],\n    'set/has': (s) => (v) => s.includes(v),\n    'set/rm': (s) => (v) => s.filter((i) => !equal(i, v)),\n    // NOTE this is only working for primitives\n    'set/diff': (a) => (b) => a.filter((i) => !b.some((j) => equal(i, j))),\n    'set/merge': (a) => (b) =>\n        [...a, ...b.filter((x) => !a.some((y) => equal(y, x)))],\n    'set/overlap': (a) => (b) => a.filter((x) => b.some((y) => equal(y, x))),\n    'set/to-list': wrapList,\n    'set/from-list': (s) => {\n        const res = [];\n        unwrapList(s).forEach((item) => {\n            if (res.some((m) => equal(item, m))) {\n                return;\n            }\n            res.push(item);\n        });\n        return res;\n    },\n\n    // Various debugging stuff\n    jsonify: (v) => JSON.stringify(v) ?? 'undefined',\n    fatal: (message) => {\n        throw new Error(`Fatal runtime: ${message}`);\n    },\n}","loc":6564}},"meta":{},"metaPrev":{},"map":{"6564":{"type":"raw-code","lang":"javascript","raw":"function equal(a, b) {\n    if (a === b) return true;\n\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\n        var length, i, keys;\n        if (Array.isArray(a)) {\n            length = a.length;\n            if (length != b.length) return false;\n            for (i = length; i-- !== 0; ) if (!equal(a[i], b[i])) return false;\n            return true;\n        }\n\n        keys = Object.keys(a);\n        length = keys.length;\n        if (length !== Object.keys(b).length) return false;\n\n        for (i = length; i-- !== 0; ) {\n            if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n        }\n\n        for (i = length; i-- !== 0; ) {\n            var key = keys[i];\n\n            if (!equal(a[key], b[key])) return false;\n        }\n\n        return true;\n    }\n\n    // true if both NaN, false otherwise\n    return a !== a && b !== b;\n}\n\nfunction unescapeString(n) {\n    if (n == null || !n.replaceAll) {\n        debugger;\n        return '';\n    }\n    return n.replaceAll(/\\\\\\\\./g, (m) => {\n        if (m[1] === 'n') {\n            return '\\\\n';\n        }\n        if (m[1] === 't') {\n            return '\\\\t';\n        }\n        if (m[1] === 'r') {\n            return '\\\\r';\n        }\n        return m[1];\n    });\n}\n\nfunction unwrapList(v) {\n  const res = [];\n  for (;v.type !== 'nil';v=v[1]) {\n    res.push(v[0]);\n  }\n  return res;\n}\n\nfunction wrapList(v) {\n    let res = { type: 'nil' };\n    for (let i = v.length - 1; i >= 0; i--) {\n        res = { type: 'cons', 0: v[i], 1: res };\n    }\n    return res;\n}\n\nconst sanMap = {\n    // '$$$$' gets interpreted by replaceAll as '$$', for reasons\n    $: '$$$$',\n    '-': '_',\n    '+': '$pl',\n    '*': '$ti',\n    '=': '$eq',\n    '>': '$gt',\n    '<': '$lt',\n    \"'\": '$qu',\n    '\"': '$dq',\n    ',': '$co',\n    '/': '$sl',\n    ';': '$semi',\n    '@': '$at',\n    ':': '$cl',\n    '#': '$ha',\n    '!': '$ex',\n    '|': '$bar',\n    '()': '$unit',\n    '?': '$qe',\n  };\nconst kwds =\n    'case new var const let if else return super break while for default eval'.split(' ');\n\n// Convert an identifier into a valid js identifier, replacing special characters, and accounting for keywords.\nfunction sanitize(raw) {\n    for (let [key, val] of Object.entries(sanMap)) {\n        raw = raw.replaceAll(key, val);\n    }\n    if (kwds.includes(raw)) return '$' + raw\n    return raw\n}\n\nconst valueToString = (v) => {\n    if (Array.isArray(v)) {\n        return `[${v.map(valueToString).join(', ')}]`;\n    }\n    if (typeof v === 'object' && v && 'type' in v) {\n        if (v.type === 'cons' || v.type === 'nil') {\n            const un = unwrapList(v);\n            return '[' + un.map(valueToString).join(' ') + ']';\n        }\n\n        let args = [];\n        for (let i = 0; i in v; i++) {\n            args.push(v[i]);\n        }\n        return `(${v.type}${args\n            .map((arg) => ' ' + valueToString(arg))\n            .join('')})`;\n    }\n    if (typeof v === 'string') {\n        if (v.includes('\"') && !v.includes(\"'\")) {\n            return (\n                \"'\" + JSON.stringify(v).slice(1, -1).replace(/\\\\\"/g, '\"') + \"'\"\n            );\n        }\n        return JSON.stringify(v);\n    }\n    if (typeof v === 'function') {\n        return '<function>';\n    }\n\n    return '' + v;\n};\n\nreturn {\n    '+': (a) => (b) => a + b,\n    '-': (a) => (b) => a - b,\n    '<': (a) => (b) => a < b,\n    '<=': (a) => (b) => a <= b,\n    '>': (a) => (b) => a > b,\n    '>=': (a) => (b) => a >= b,\n    '=': (a) => (b) => equal(a, b),\n    '!=': (a) => (b) => !equal(a, b),\n    pi: Math.PI,\n    'replace-all': a => b => c => a.replaceAll(b, c),\n    eval: source => {\n      return new Function('', 'return ' + source)();\n    },\n    'eval-with': ctx => source => {\n      const args = '{' + Object.keys(ctx).join(',') + '}'\n      return new Function(args, 'return ' + source)(ctx);\n    },\n    $unit: null,\n    errorToString: f => arg => {\n      try {\n        return f(arg)\n      } catch (err) {\n        return err.message;\n      }\n    },\n    valueToString,\n    unescapeString,\n    sanitize,\n    equal: a => b => equal(a, b),\n    'int-to-string': (a) => a.toString(),\n    'float-to-string': a => a.toString(),\n    'string-to-int': (a) => {\n        const v = Number(a);\n        return Number.isInteger(v) && v.toString() === a ? { type: 'some', 0: v } : { type: 'none' };\n    },\n    'string-to-float': (a) => {\n        const v = Number(a);\n        return Number.isFinite(v) ? { type: 'some', 0: v } : { type: 'none' };\n    },\n\n    // maps\n    'map/nil': [],\n    'map/set': (map) => (key) => (value) =>\n        [[key, value], ...map.filter((i) => i[0] !== key)],\n    'map/rm': (map) => (key) => map.filter((i) => !equal(i[0], key)),\n    'map/get': (map) => (key) => {\n        const found = map.find((i) => equal(i[0], key));\n        return found ? { type: 'some', 0: found[1] } : { type: 'none' };\n    },\n    'map/map': (fn) => (map) => map.map(([k, v]) => [k, fn(v)]),\n    'map/merge': (one) => (two) =>\n        [...one, ...two.filter(([key]) => !one.find(([a]) => equal(a, key)))],\n    'map/values': (map) => wrapList(map.map((item) => item[1])),\n    'map/keys': (map) => wrapList(map.map((item) => item[0])),\n    'map/from-list': (list) =>\n        unwrapList(list).map((pair) => [pair[0], pair[1]]),\n    'map/to-list': (map) =>\n        wrapList(map.map(([key, value]) => ({ type: ',', 0: key, 1: value }))),\n\n    // sets\n    'set/nil': [],\n    'set/add': (s) => (v) => [v, ...s.filter((m) => !equal(v, m))],\n    'set/has': (s) => (v) => s.includes(v),\n    'set/rm': (s) => (v) => s.filter((i) => !equal(i, v)),\n    // NOTE this is only working for primitives\n    'set/diff': (a) => (b) => a.filter((i) => !b.some((j) => equal(i, j))),\n    'set/merge': (a) => (b) =>\n        [...a, ...b.filter((x) => !a.some((y) => equal(y, x)))],\n    'set/overlap': (a) => (b) => a.filter((x) => b.some((y) => equal(y, x))),\n    'set/to-list': wrapList,\n    'set/from-list': (s) => {\n        const res = [];\n        unwrapList(s).forEach((item) => {\n            if (res.some((m) => equal(item, m))) {\n                return;\n            }\n            res.push(item);\n        });\n        return res;\n    },\n\n    // Various debugging stuff\n    jsonify: (v) => JSON.stringify(v) ?? 'undefined',\n    fatal: (message) => {\n        throw new Error(`Fatal runtime: ${message}`);\n    },\n}","loc":6564}},"nsMap":{},"nsPrev":{},"id":0,"ts":1719088840.777,"libraryRoot":""}],"clipboard":[],"hover":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":6561,"idx":3465},{"type":"ns","child":6563,"idx":6561},{"type":"ns-top","idx":6563},{"idx":6565,"type":"child","at":2}],"regs":{},"at":[{"start":[{"type":"card","idx":-1,"card":0},{"type":"ns","child":6561,"idx":3465},{"type":"ns","child":6563,"idx":6561},{"type":"ns-top","idx":6563},{"idx":6565,"type":"child","at":2},{"type":"rich-text","idx":6564,"sel":null}]}],"map":{"529":{"loc":529,"type":"list","values":[530,531,535,538]},"530":{"loc":530,"type":"identifier","text":"deftype"},"531":{"loc":531,"type":"identifier","text":"prim"},"535":{"loc":535,"type":"list","values":[536,537,5378]},"536":{"loc":536,"type":"identifier","text":"pint"},"537":{"loc":537,"type":"identifier","text":"int"},"538":{"loc":538,"type":"list","values":[539,540,5379]},"539":{"loc":539,"type":"identifier","text":"pbool"},"540":{"loc":540,"type":"identifier","text":"bool"},"541":{"loc":541,"type":"list","values":[542,543,544,546,3935,4149,549]},"542":{"loc":542,"type":"identifier","text":"deftype"},"543":{"loc":543,"type":"identifier","text":"pat"},"544":{"loc":544,"type":"list","values":[545,5055]},"545":{"loc":545,"type":"identifier","text":"pany"},"546":{"loc":546,"type":"list","values":[547,548,5056]},"547":{"loc":547,"type":"identifier","text":"pvar"},"548":{"loc":548,"type":"identifier","text":"string"},"549":{"loc":549,"type":"list","values":[550,551,5302,552,5059]},"550":{"loc":550,"type":"identifier","text":"pcon"},"551":{"loc":551,"type":"identifier","text":"string"},"552":{"loc":552,"type":"list","values":[553,554]},"553":{"loc":553,"type":"identifier","text":"list"},"554":{"type":"identifier","text":"pat","loc":554},"555":{"loc":555,"type":"list","values":[556,557,558,561,565]},"556":{"loc":556,"type":"identifier","text":"deftype"},"557":{"loc":557,"type":"identifier","text":"type"},"558":{"loc":558,"type":"list","values":[559,560,5061]},"559":{"loc":559,"type":"identifier","text":"tvar"},"560":{"loc":560,"type":"identifier","text":"string"},"561":{"loc":561,"type":"list","values":[562,563,564,5060]},"562":{"loc":562,"type":"identifier","text":"tapp"},"563":{"loc":563,"type":"identifier","text":"type"},"564":{"loc":564,"type":"identifier","text":"type"},"565":{"loc":565,"type":"list","values":[566,567,5062]},"566":{"loc":566,"type":"identifier","text":"tcon"},"567":{"loc":567,"type":"identifier","text":"string"},"568":{"loc":568,"type":"list","values":[659,660,661,672,676,6515]},"590":{"loc":590,"type":"list","values":[592,594,614,602]},"592":{"loc":592,"type":"identifier","text":"deftype"},"594":{"loc":594,"type":"list","values":[598,600]},"598":{"loc":598,"type":"identifier","text":"list"},"600":{"loc":600,"type":"identifier","text":"a"},"602":{"loc":602,"type":"list","values":[604,606,608]},"604":{"loc":604,"type":"identifier","text":"cons"},"606":{"loc":606,"type":"identifier","text":"a"},"608":{"loc":608,"type":"list","values":[610,612]},"610":{"loc":610,"type":"identifier","text":"list"},"612":{"loc":612,"type":"identifier","text":"a"},"614":{"loc":614,"type":"list","values":[616]},"616":{"loc":616,"type":"identifier","text":"nil"},"618":{"loc":618,"type":"list","values":[620,622,630]},"620":{"loc":620,"type":"identifier","text":"deftype"},"622":{"loc":622,"type":"list","values":[624,626,628]},"624":{"loc":624,"type":"identifier","text":","},"626":{"loc":626,"type":"identifier","text":"a"},"628":{"loc":628,"type":"identifier","text":"b"},"630":{"loc":630,"type":"list","values":[632,634,636]},"632":{"loc":632,"type":"identifier","text":","},"634":{"loc":634,"type":"identifier","text":"a"},"636":{"loc":636,"type":"identifier","text":"b"},"638":{"loc":638,"type":"list","values":[725,726,727,729]},"659":{"loc":659,"type":"identifier","text":"deftype"},"660":{"loc":660,"type":"identifier","text":"top"},"661":{"loc":661,"type":"list","values":[662,663,6416,6418,664,5063]},"662":{"loc":662,"type":"identifier","text":"tdeftype"},"663":{"loc":663,"type":"identifier","text":"string"},"664":{"loc":664,"type":"list","values":[665,666]},"665":{"loc":665,"type":"identifier","text":"list"},"666":{"loc":666,"type":"list","values":[667,668,6524,669,4901]},"667":{"loc":667,"type":"identifier","text":","},"668":{"loc":668,"type":"identifier","text":"string"},"669":{"loc":669,"type":"list","values":[670,671]},"670":{"loc":670,"type":"identifier","text":"list"},"671":{"type":"identifier","text":"type","loc":671},"672":{"loc":672,"type":"list","values":[673,674,6414,675,5064]},"673":{"loc":673,"type":"identifier","text":"tdef"},"674":{"loc":674,"type":"identifier","text":"string"},"675":{"loc":675,"type":"identifier","text":"expr"},"676":{"loc":676,"type":"list","values":[677,678,5065]},"677":{"loc":677,"type":"identifier","text":"texpr"},"678":{"loc":678,"type":"identifier","text":"expr"},"725":{"loc":725,"type":"identifier","text":"defn"},"726":{"loc":726,"type":"identifier","text":"compile-top"},"727":{"loc":727,"type":"array","values":[728]},"728":{"loc":728,"type":"identifier","text":"top"},"729":{"loc":729,"type":"list","values":[730,731,732,735,738,745,757,763,6518,6520]},"730":{"loc":730,"type":"identifier","text":"match"},"731":{"loc":731,"type":"identifier","text":"top"},"732":{"loc":732,"type":"list","values":[733,734,5066]},"733":{"loc":733,"type":"identifier","text":"texpr"},"734":{"loc":734,"type":"identifier","text":"expr"},"735":{"loc":735,"type":"list","values":[736,737]},"736":{"loc":736,"type":"identifier","text":"compile"},"737":{"loc":737,"type":"identifier","text":"expr"},"738":{"loc":738,"type":"list","values":[739,740,6415,741,5068]},"739":{"loc":739,"type":"identifier","text":"tdef"},"740":{"loc":740,"type":"identifier","text":"name"},"741":{"loc":741,"type":"identifier","text":"body"},"743":{"type":"blank","loc":743},"745":{"loc":745,"type":"string","first":746,"templates":[{"expr":5434,"suffix":5435},{"expr":5438,"suffix":5439}]},"746":{"loc":746,"type":"stringText","text":"const "},"757":{"loc":757,"type":"list","values":[758,759,6427,6417,760,5069]},"758":{"loc":758,"type":"identifier","text":"tdeftype"},"759":{"loc":759,"type":"identifier","text":"name"},"760":{"loc":760,"type":"identifier","text":"cases"},"763":{"loc":763,"type":"list","values":[2190,2192,2196]},"828":{"loc":828,"type":"list","values":[1742,1743,1744,1746]},"1742":{"loc":1742,"type":"identifier","text":"defn"},"1743":{"loc":1743,"type":"identifier","text":"compile"},"1744":{"loc":1744,"type":"array","values":[1745]},"1745":{"loc":1745,"type":"identifier","text":"expr"},"1746":{"loc":1746,"type":"list","values":[1747,1748,6234,4378,4446,1749,5387,1788,1791,2824,2830,6331,1794,5242,6334,1811,5198,6332,1836,5181,6336,1875,6030]},"1747":{"loc":1747,"type":"identifier","text":"match"},"1748":{"loc":1748,"type":"identifier","text":"expr"},"1749":{"loc":1749,"type":"list","values":[1750,1751,4916]},"1750":{"loc":1750,"type":"identifier","text":"eprim"},"1751":{"loc":1751,"type":"identifier","text":"prim"},"1752":{"loc":1752,"type":"list","values":[1753,1754,1772,1775,1778,1781]},"1753":{"loc":1753,"type":"identifier","text":"match"},"1754":{"loc":1754,"type":"identifier","text":"prim"},"1772":{"loc":1772,"type":"list","values":[1773,1774,5380]},"1773":{"loc":1773,"type":"identifier","text":"pint"},"1774":{"loc":1774,"type":"identifier","text":"int"},"1775":{"loc":1775,"type":"list","values":[1776,1777]},"1776":{"loc":1776,"type":"identifier","text":"int-to-string"},"1777":{"loc":1777,"type":"identifier","text":"int"},"1778":{"loc":1778,"type":"list","values":[1779,1780,5381]},"1779":{"loc":1779,"type":"identifier","text":"pbool"},"1780":{"loc":1780,"type":"identifier","text":"bool"},"1781":{"loc":1781,"type":"list","values":[1782,1783,4075,1784,4076,1786]},"1782":{"type":"identifier","text":"match","loc":1782},"1783":{"loc":1783,"type":"identifier","text":"bool"},"1784":{"loc":1784,"type":"string","first":1785,"templates":[]},"1785":{"loc":1785,"type":"stringText","text":"true"},"1786":{"loc":1786,"type":"string","first":1787,"templates":[]},"1787":{"loc":1787,"type":"stringText","text":"false"},"1788":{"loc":1788,"type":"list","values":[1789,1790,4917]},"1789":{"loc":1789,"type":"identifier","text":"evar"},"1790":{"loc":1790,"type":"identifier","text":"name"},"1791":{"loc":1791,"type":"list","values":[1792,1793]},"1792":{"loc":1792,"type":"identifier","text":"sanitize"},"1793":{"loc":1793,"type":"identifier","text":"name"},"1794":{"loc":1794,"type":"list","values":[1795,1796,1797,4919]},"1795":{"loc":1795,"type":"identifier","text":"elambda"},"1796":{"loc":1796,"type":"identifier","text":"pats"},"1797":{"loc":1797,"type":"identifier","text":"body"},"1801":{"loc":1801,"type":"string","first":1802,"templates":[{"expr":5229,"suffix":6308},{"expr":6309,"suffix":6310}]},"1802":{"loc":1802,"type":"stringText","text":"("},"1804":{"loc":1804,"type":"identifier","text":"pat-as-arg"},"1805":{"loc":1805,"type":"identifier","text":"pat"},"1811":{"loc":1811,"type":"list","values":[1812,1813,1815,4920]},"1812":{"loc":1812,"type":"identifier","text":"elet"},"1813":{"type":"identifier","text":"bindings","loc":1813},"1815":{"loc":1815,"type":"identifier","text":"body"},"1836":{"loc":1836,"type":"list","values":[1837,1838,1839,4921]},"1837":{"loc":1837,"type":"identifier","text":"eapp"},"1838":{"loc":1838,"type":"identifier","text":"f"},"1839":{"loc":1839,"type":"identifier","text":"args"},"1875":{"loc":1875,"type":"list","values":[1876,1877,1878,4922]},"1876":{"loc":1876,"type":"identifier","text":"ematch"},"1877":{"loc":1877,"type":"identifier","text":"target"},"1878":{"loc":1878,"type":"identifier","text":"cases"},"2008":{"loc":2008,"type":"list","values":[2010,2012,2014,2020]},"2010":{"loc":2010,"type":"identifier","text":"defn"},"2012":{"loc":2012,"type":"identifier","text":"join"},"2014":{"loc":2014,"type":"array","values":[2016,2018]},"2016":{"loc":2016,"type":"identifier","text":"sep"},"2018":{"loc":2018,"type":"identifier","text":"items"},"2020":{"loc":2020,"type":"list","values":[2022,2024,2026,2028,2032,2176]},"2022":{"loc":2022,"type":"identifier","text":"match"},"2024":{"loc":2024,"type":"identifier","text":"items"},"2026":{"loc":2026,"type":"array","values":[]},"2028":{"loc":2028,"type":"string","first":2030,"templates":[]},"2030":{"loc":2030,"type":"stringText","text":""},"2032":{"loc":2032,"type":"array","values":[2034,2042]},"2034":{"loc":2034,"type":"identifier","text":"one"},"2036":{"loc":2036,"type":"identifier","text":"rest"},"2042":{"loc":2042,"type":"spread","contents":2036},"2176":{"loc":2176,"type":"list","values":[2178,2180,2182,2184,2188,4808]},"2178":{"loc":2178,"type":"identifier","text":"match"},"2180":{"loc":2180,"type":"identifier","text":"rest"},"2182":{"loc":2182,"type":"array","values":[]},"2184":{"loc":2184,"type":"identifier","text":"one"},"2188":{"loc":2188,"type":"identifier","text":"_"},"2190":{"loc":2190,"type":"identifier","text":"join"},"2192":{"loc":2192,"type":"string","first":2194,"templates":[]},"2194":{"loc":2194,"type":"stringText","text":"\\n"},"2196":{"loc":2196,"type":"list","values":[2198,2200,2202]},"2198":{"loc":2198,"type":"identifier","text":"map"},"2200":{"loc":2200,"type":"identifier","text":"cases"},"2202":{"loc":2202,"type":"list","values":[2204,2212,2216]},"2204":{"loc":2204,"type":"identifier","text":"fn"},"2212":{"loc":2212,"type":"array","values":[2214]},"2214":{"loc":2214,"type":"identifier","text":"case"},"2216":{"loc":2216,"type":"list","values":[2218,2220,5444]},"2218":{"loc":2218,"type":"identifier","text":"let"},"2220":{"loc":2220,"type":"array","values":[2222,2310,5524,5526,5546,5548]},"2222":{"loc":2222,"type":"list","values":[2224,2226,6514,2228,4719]},"2224":{"loc":2224,"type":"identifier","text":","},"2226":{"loc":2226,"type":"identifier","text":"name"},"2228":{"loc":2228,"type":"identifier","text":"args"},"2248":{"loc":2248,"type":"list","values":[2250,2252,2254,2266]},"2250":{"loc":2250,"type":"identifier","text":"defn"},"2252":{"loc":2252,"type":"identifier","text":"map"},"2254":{"loc":2254,"type":"array","values":[2262,2264]},"2262":{"loc":2262,"type":"identifier","text":"values"},"2264":{"loc":2264,"type":"identifier","text":"f"},"2266":{"loc":2266,"type":"list","values":[2268,2270,2272,2274,2276,2288]},"2268":{"loc":2268,"type":"identifier","text":"match"},"2270":{"loc":2270,"type":"identifier","text":"values"},"2272":{"loc":2272,"type":"array","values":[]},"2274":{"loc":2274,"type":"array","values":[]},"2276":{"loc":2276,"type":"array","values":[2278,2286]},"2278":{"loc":2278,"type":"identifier","text":"one"},"2280":{"loc":2280,"type":"identifier","text":"rest"},"2286":{"loc":2286,"type":"spread","contents":2280},"2288":{"loc":2288,"type":"array","values":[2290,2302]},"2290":{"loc":2290,"type":"list","values":[2292,2294]},"2292":{"loc":2292,"type":"identifier","text":"f"},"2294":{"loc":2294,"type":"identifier","text":"one"},"2296":{"loc":2296,"type":"list","values":[2304,2306,2308]},"2302":{"loc":2302,"type":"spread","contents":2296},"2304":{"loc":2304,"type":"identifier","text":"map"},"2306":{"loc":2306,"type":"identifier","text":"rest"},"2308":{"loc":2308,"type":"identifier","text":"f"},"2310":{"loc":2310,"type":"identifier","text":"case"},"2312":{"loc":2312,"type":"list","values":[2314,2316,2318,2326]},"2314":{"loc":2314,"type":"identifier","text":"defn"},"2316":{"loc":2316,"type":"identifier","text":"foldl"},"2318":{"loc":2318,"type":"array","values":[2320,2322,2324]},"2320":{"loc":2320,"type":"identifier","text":"init"},"2322":{"loc":2322,"type":"identifier","text":"items"},"2324":{"loc":2324,"type":"identifier","text":"f"},"2326":{"loc":2326,"type":"list","values":[2328,2330,2332,2334,2336,2352]},"2328":{"loc":2328,"type":"identifier","text":"match"},"2330":{"loc":2330,"type":"identifier","text":"items"},"2332":{"loc":2332,"type":"array","values":[]},"2334":{"loc":2334,"type":"identifier","text":"init"},"2336":{"loc":2336,"type":"array","values":[2338,2346]},"2338":{"loc":2338,"type":"identifier","text":"one"},"2340":{"loc":2340,"type":"identifier","text":"rest"},"2346":{"loc":2346,"type":"spread","contents":2340},"2352":{"loc":2352,"type":"list","values":[2354,2356,2364,2366]},"2354":{"loc":2354,"type":"identifier","text":"foldl"},"2356":{"loc":2356,"type":"list","values":[2358,2360,2362]},"2358":{"loc":2358,"type":"identifier","text":"f"},"2360":{"loc":2360,"type":"identifier","text":"init"},"2362":{"loc":2362,"type":"identifier","text":"one"},"2364":{"loc":2364,"type":"identifier","text":"rest"},"2366":{"loc":2366,"type":"identifier","text":"f"},"2402":{"loc":2402,"type":"list","values":[2430,2431,2432,2435]},"2430":{"loc":2430,"type":"identifier","text":"defn"},"2431":{"loc":2431,"type":"identifier","text":"mapi"},"2432":{"loc":2432,"type":"array","values":[2433,2460,2434]},"2433":{"loc":2433,"type":"identifier","text":"i"},"2434":{"loc":2434,"type":"identifier","text":"f"},"2435":{"loc":2435,"type":"list","values":[2436,2437,2438,2439,2440,2446]},"2436":{"loc":2436,"type":"identifier","text":"match"},"2437":{"loc":2437,"type":"identifier","text":"values"},"2438":{"loc":2438,"type":"array","values":[]},"2439":{"loc":2439,"type":"array","values":[]},"2440":{"loc":2440,"type":"array","values":[2441,2445]},"2441":{"loc":2441,"type":"identifier","text":"one"},"2442":{"loc":2442,"type":"identifier","text":"rest"},"2445":{"loc":2445,"type":"spread","contents":2442},"2446":{"loc":2446,"type":"array","values":[2447,2453]},"2447":{"loc":2447,"type":"list","values":[2448,2449,2462]},"2448":{"loc":2448,"type":"identifier","text":"f"},"2449":{"loc":2449,"type":"identifier","text":"i"},"2450":{"loc":2450,"type":"list","values":[2454,2464,2455,2456]},"2453":{"loc":2453,"type":"spread","contents":2450},"2454":{"loc":2454,"type":"identifier","text":"mapi"},"2455":{"loc":2455,"type":"identifier","text":"rest"},"2456":{"loc":2456,"type":"identifier","text":"f"},"2460":{"loc":2460,"type":"identifier","text":"values"},"2462":{"loc":2462,"type":"identifier","text":"one"},"2464":{"loc":2464,"type":"list","values":[2466,2468,2470]},"2466":{"loc":2466,"type":"identifier","text":"+"},"2468":{"loc":2468,"type":"identifier","text":"1"},"2470":{"loc":2470,"type":"identifier","text":"i"},"2658":{"loc":2658,"type":"list","values":[2684,2685,2686,2690]},"2684":{"loc":2684,"type":"identifier","text":"defn"},"2685":{"loc":2685,"type":"identifier","text":"foldr"},"2686":{"loc":2686,"type":"array","values":[2687,2688,2689]},"2687":{"loc":2687,"type":"identifier","text":"init"},"2688":{"loc":2688,"type":"identifier","text":"items"},"2689":{"loc":2689,"type":"identifier","text":"f"},"2690":{"loc":2690,"type":"list","values":[2691,2692,2693,2694,2695,2710]},"2691":{"loc":2691,"type":"identifier","text":"match"},"2692":{"loc":2692,"type":"identifier","text":"items"},"2693":{"loc":2693,"type":"array","values":[]},"2694":{"loc":2694,"type":"identifier","text":"init"},"2695":{"loc":2695,"type":"array","values":[2696,2700]},"2696":{"loc":2696,"type":"identifier","text":"one"},"2697":{"loc":2697,"type":"identifier","text":"rest"},"2700":{"loc":2700,"type":"spread","contents":2697},"2710":{"loc":2710,"type":"list","values":[2712,2714,2724]},"2712":{"loc":2712,"type":"identifier","text":"f"},"2714":{"loc":2714,"type":"list","values":[2716,2718,2720,2722]},"2716":{"loc":2716,"type":"identifier","text":"foldr"},"2718":{"loc":2718,"type":"identifier","text":"init"},"2720":{"loc":2720,"type":"identifier","text":"rest"},"2722":{"loc":2722,"type":"identifier","text":"f"},"2724":{"loc":2724,"type":"identifier","text":"one"},"2806":{"type":"blank","loc":2806},"2824":{"type":"list","values":[2826,2828,4918],"loc":2824},"2826":{"type":"identifier","text":"equot","loc":2826},"2828":{"type":"identifier","text":"inner","loc":2828},"2830":{"type":"list","values":[5345,5346],"loc":2830},"2864":{"type":"list","values":[2866,2870,2872,2878],"loc":2864},"2866":{"type":"identifier","text":"defn","loc":2866},"2870":{"type":"identifier","text":"replaces","loc":2870},"2872":{"type":"array","values":[2874,2876],"loc":2872},"2874":{"type":"identifier","text":"target","loc":2874},"2876":{"type":"identifier","text":"repl","loc":2876},"2878":{"type":"list","values":[2880,2882,2884,2886,2952,2964],"loc":2878},"2880":{"type":"identifier","text":"match","loc":2880},"2882":{"type":"identifier","text":"repl","loc":2882},"2884":{"type":"array","values":[],"loc":2884},"2886":{"type":"identifier","text":"target","loc":2886},"2907":{"type":"recordAccess","target":2898,"items":[2908],"loc":2907},"2908":{"type":"accessText","text":"","loc":2908},"2930":{"type":"list","values":[2932,2934,2938],"loc":2930},"2932":{"type":"identifier","text":"replaces","loc":2932},"2934":{"type":"string","first":2936,"templates":[],"loc":2934},"2936":{"type":"stringText","loc":2936,"text":"\\n"},"2938":{"type":"array","values":[3282,3294],"loc":2938},"2952":{"type":"array","values":[2954,2962],"loc":2952},"2954":{"type":"identifier","text":"one","loc":2954},"2956":{"type":"identifier","text":"rest","loc":2956},"2962":{"type":"spread","contents":2956,"loc":2962},"2964":{"type":"list","values":[2966,2968,2970,2978],"loc":2964},"2966":{"type":"identifier","text":"match","loc":2966},"2968":{"type":"identifier","text":"one","loc":2968},"2970":{"type":"list","values":[2972,2974,2976],"loc":2970},"2972":{"type":"identifier","text":",","loc":2972},"2974":{"type":"identifier","text":"find","loc":2974},"2976":{"type":"identifier","text":"nw","loc":2976},"2978":{"type":"list","values":[2986,2987,2992],"loc":2978},"2986":{"type":"identifier","text":"replaces","loc":2986},"2987":{"type":"list","values":[2988,2989,2990,2991],"loc":2987},"2988":{"type":"identifier","text":"replace-all","loc":2988},"2989":{"type":"identifier","text":"target","loc":2989},"2990":{"type":"identifier","text":"find","loc":2990},"2991":{"type":"identifier","text":"nw","loc":2991},"2992":{"type":"identifier","text":"rest","loc":2992},"3118":{"type":"list","values":[3120,3122,3124,5403],"loc":3118},"3120":{"type":"identifier","text":"defn","loc":3120},"3122":{"type":"identifier","text":"constructor-fn","loc":3122},"3124":{"type":"array","values":[3126,3128],"loc":3124},"3126":{"type":"identifier","text":"name","loc":3126},"3128":{"type":"identifier","text":"args","loc":3128},"3282":{"type":"list","values":[3284,3286,3290],"loc":3282},"3284":{"type":"identifier","text":",","loc":3284},"3286":{"type":"string","first":3288,"templates":[],"loc":3286},"3288":{"type":"stringText","loc":3288,"text":"\\\\"},"3290":{"type":"string","first":3292,"templates":[],"loc":3290},"3292":{"type":"stringText","loc":3292,"text":"\\\\\\\\"},"3294":{"type":"list","values":[3296,3298,3302],"loc":3294},"3296":{"type":"identifier","text":",","loc":3296},"3298":{"type":"string","first":3300,"templates":[],"loc":3298},"3300":{"type":"stringText","loc":3300,"text":"\\n"},"3302":{"type":"string","first":3304,"templates":[],"loc":3302},"3304":{"type":"stringText","loc":3304,"text":"\\\\n"},"3306":{"type":"list","values":[3308,3310,3414,3314],"loc":3306},"3308":{"type":"identifier","text":"defn","loc":3308},"3310":{"type":"identifier","text":"escape-string","loc":3310},"3312":{"type":"identifier","text":"string","loc":3312},"3314":{"type":"list","values":[3316,3318,3320],"loc":3314},"3316":{"type":"identifier","text":"replaces","loc":3316},"3318":{"type":"identifier","text":"string","loc":3318},"3320":{"type":"array","values":[3322,3334,3346,4474,4480],"loc":3320},"3322":{"type":"list","values":[3324,3326,3330],"loc":3322},"3324":{"type":"identifier","text":",","loc":3324},"3326":{"type":"string","first":3328,"templates":[],"loc":3326},"3328":{"type":"stringText","loc":3328,"text":"\\\\"},"3330":{"type":"string","first":3332,"templates":[],"loc":3330},"3332":{"type":"stringText","loc":3332,"text":"\\\\\\\\"},"3334":{"type":"list","values":[3336,3338,3342],"loc":3334},"3336":{"type":"identifier","text":",","loc":3336},"3338":{"type":"string","first":3340,"templates":[],"loc":3338},"3340":{"type":"stringText","loc":3340,"text":"\\n"},"3342":{"type":"string","first":3344,"templates":[],"loc":3342},"3344":{"type":"stringText","loc":3344,"text":"\\\\n"},"3346":{"type":"list","values":[3348,3350,3354],"loc":3346},"3348":{"type":"identifier","text":",","loc":3348},"3350":{"type":"string","first":3352,"templates":[],"loc":3350},"3352":{"type":"stringText","loc":3352,"text":"\\\""},"3354":{"type":"string","first":3356,"templates":[],"loc":3354},"3356":{"type":"stringText","loc":3356,"text":"\\\\\""},"3414":{"type":"array","values":[3312],"loc":3414},"3514":{"type":"rich-text","contents":[{"id":"6d7c6456-dc10-4630-89bc-30a8b9add6bd","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":2},"content":[{"type":"text","text":"Our AST","styles":{}}],"children":[]}],"loc":3514},"3522":{"type":"rich-text","contents":[{"id":"d49139bb-3863-41df-8df3-46965796412c","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":2},"content":[{"type":"text","text":"Prelude","styles":{}}],"children":[]}],"loc":3522},"3539":{"type":"rich-text","contents":[{"id":"c6cae547-b425-45fe-abee-0d7651a7231f","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":3},"content":[{"type":"text","text":"String escape utils","styles":{}}],"children":[]}],"loc":3539},"3569":{"type":"list","values":[3571,3572,3573],"loc":3569},"3571":{"type":"identifier","text":",","loc":3571},"3572":{"type":"list","values":[5568,5569,5572],"loc":3572},"3573":{"type":"array","values":[3574,3582,3592,5347,4436,3674,3689,3899,3914,4004,6375,4486,4496,6359],"loc":3573},"3574":{"type":"list","values":[3575,3576,3579],"loc":3574},"3575":{"type":"identifier","text":",","loc":3575},"3576":{"type":"list","values":[3577,3578],"loc":3576},"3577":{"type":"identifier","text":"@","loc":3577},"3578":{"type":"identifier","text":"1","loc":3578},"3579":{"type":"identifier","text":"1","loc":3579},"3582":{"type":"list","values":[3585,3586,3590],"loc":3582},"3584":{"type":"blank","loc":3584},"3585":{"type":"identifier","text":",","loc":3585},"3586":{"type":"list","values":[3587,3588],"loc":3586},"3587":{"type":"identifier","text":"@","loc":3587},"3588":{"type":"string","first":3589,"templates":[],"loc":3588},"3589":{"type":"stringText","loc":3589,"text":"hello"},"3590":{"type":"string","first":3670,"templates":[],"loc":3590},"3592":{"type":"list","values":[3593,3594,3600],"loc":3592},"3593":{"type":"identifier","text":",","loc":3593},"3594":{"type":"list","values":[3595,3596],"loc":3594},"3595":{"type":"identifier","text":"@","loc":3595},"3596":{"type":"list","values":[3597,3598,3599],"loc":3596},"3597":{"type":"identifier","text":"+","loc":3597},"3598":{"type":"identifier","text":"2","loc":3598},"3599":{"type":"identifier","text":"3","loc":3599},"3600":{"type":"identifier","text":"5","loc":3600},"3670":{"type":"stringText","loc":3670,"text":"hello"},"3674":{"type":"list","values":[3675,3676,3677],"loc":3674},"3675":{"type":"identifier","text":",","loc":3675},"3676":{"type":"list","values":[3678,3679],"loc":3676},"3677":{"type":"identifier","text":"23","loc":3677},"3678":{"type":"identifier","text":"@","loc":3678},"3679":{"type":"list","values":[3680,3688],"loc":3679},"3680":{"type":"list","values":[3681,3682,3684],"loc":3680},"3681":{"type":"identifier","text":"fn","loc":3681},"3682":{"type":"array","values":[3683],"loc":3682},"3683":{"type":"identifier","text":"a","loc":3683},"3684":{"type":"list","values":[3685,3686,3687],"loc":3684},"3685":{"type":"identifier","text":"+","loc":3685},"3686":{"type":"identifier","text":"a","loc":3686},"3687":{"type":"identifier","text":"2","loc":3687},"3688":{"type":"identifier","text":"21","loc":3688},"3689":{"type":"list","values":[3690,3691,3692],"loc":3689},"3690":{"type":"identifier","text":",","loc":3690},"3691":{"type":"list","values":[3693,3694],"loc":3691},"3692":{"type":"identifier","text":"3","loc":3692},"3693":{"type":"identifier","text":"@","loc":3693},"3694":{"type":"list","values":[3695,3696,3701],"loc":3694},"3695":{"type":"identifier","text":"let","loc":3695},"3696":{"type":"array","values":[3697,3698,3699,3700],"loc":3696},"3697":{"type":"identifier","text":"one","loc":3697},"3698":{"type":"identifier","text":"1","loc":3698},"3699":{"type":"identifier","text":"two","loc":3699},"3700":{"type":"identifier","text":"2","loc":3700},"3701":{"type":"list","values":[3702,3703,3704],"loc":3701},"3702":{"type":"identifier","text":"+","loc":3702},"3703":{"type":"identifier","text":"1","loc":3703},"3704":{"type":"identifier","text":"2","loc":3704},"3871":{"type":"recordAccess","target":3867,"items":[3872],"loc":3871},"3872":{"type":"accessText","text":"","loc":3872},"3899":{"type":"list","values":[3900,3901,3902],"loc":3899},"3900":{"type":"identifier","text":",","loc":3900},"3901":{"type":"list","values":[3903,3904],"loc":3901},"3902":{"type":"identifier","text":"1","loc":3902},"3903":{"type":"identifier","text":"@","loc":3903},"3904":{"type":"list","values":[3905,3906,3907,3908],"loc":3904},"3905":{"type":"identifier","text":"match","loc":3905},"3906":{"type":"identifier","text":"2","loc":3906},"3907":{"type":"identifier","text":"2","loc":3907},"3908":{"type":"identifier","text":"1","loc":3908},"3914":{"type":"list","values":[3915,3916,3917],"loc":3914},"3915":{"type":"identifier","text":",","loc":3915},"3916":{"type":"list","values":[3919,3920],"loc":3916},"3917":{"type":"identifier","text":"2","loc":3917},"3919":{"type":"identifier","text":"@","loc":3919},"3920":{"type":"list","values":[3927,3928,3931],"loc":3920},"3922":{"type":"blank","loc":3922},"3923":{"type":"stringText","loc":3923,"text":""},"3927":{"type":"identifier","text":"let","loc":3927},"3928":{"type":"array","values":[3929,3930],"loc":3928},"3929":{"type":"identifier","text":"a/b","loc":3929},"3930":{"type":"identifier","text":"2","loc":3930},"3931":{"type":"identifier","text":"a/b","loc":3931},"3935":{"type":"list","values":[3936,3937,5057],"loc":3935},"3936":{"type":"identifier","text":"pprim","loc":3936},"3937":{"type":"identifier","text":"prim","loc":3937},"3963":{"type":"identifier","text":"“","loc":3963},"3964":{"type":"list","values":[],"loc":3964},"3965":{"type":"annot","target":3964,"annot":3966,"loc":3965},"3966":{"type":"blank","loc":3966},"3968":{"type":"identifier","text":"otherwise","loc":3968},"4004":{"type":"list","values":[4005,4006,4007],"loc":4004},"4005":{"type":"identifier","text":",","loc":4005},"4006":{"type":"list","values":[4008,4009],"loc":4006},"4007":{"type":"identifier","text":"1","loc":4007},"4008":{"type":"identifier","text":"@","loc":4008},"4009":{"type":"list","values":[4012,4013,4014,4015,4016],"loc":4009},"4011":{"type":"blank","loc":4011},"4012":{"type":"identifier","text":"match","loc":4012},"4013":{"type":"identifier","text":"true","loc":4013},"4014":{"type":"identifier","text":"true","loc":4014},"4015":{"type":"identifier","text":"1","loc":4015},"4016":{"type":"identifier","text":"2","loc":4016},"4023":{"type":"identifier","text":"“$target","loc":4023},"4024":{"type":"identifier","text":"===","loc":4024},"4025":{"type":"identifier","text":"”","loc":4025},"4033":{"type":"identifier","text":"“","loc":4033},"4034":{"type":"identifier","text":"?","loc":4034},"4035":{"type":"identifier","text":"”","loc":4035},"4039":{"type":"identifier","text":"“","loc":4039},"4040":{"type":"blank","loc":4040},"4041":{"type":"annot","target":4040,"annot":4042,"loc":4041},"4042":{"type":"blank","loc":4042},"4043":{"type":"identifier","text":"”","loc":4043},"4050":{"type":"stringText","loc":4050,"text":""},"4075":{"type":"identifier","text":"true","loc":4075},"4076":{"type":"identifier","text":"false","loc":4076},"4077":{"type":"raw-code","lang":"javascript","raw":"compile => compile_top => builtins => ({type:'fns',  compile: a => _ => compile(a), compile_stmt: a => _ => compile_top(a), builtins})","loc":4077},"4079":{"type":"list","values":[4081,4082,4083,4085],"loc":4079},"4081":{"type":"identifier","text":"defn","loc":4081},"4082":{"type":"identifier","text":"compile-pat-naive","loc":4082},"4083":{"type":"array","values":[4084,4133,4134],"loc":4083},"4084":{"type":"identifier","text":"pat","loc":4084},"4085":{"type":"list","values":[4086,4087,4088,4090,4092,4105,4148,4154,4129,4132,4165,4283],"loc":4085},"4086":{"type":"identifier","text":"match","loc":4086},"4087":{"type":"identifier","text":"pat","loc":4087},"4088":{"type":"list","values":[4089,5070],"loc":4088},"4089":{"type":"identifier","text":"pany","loc":4089},"4090":{"type":"identifier","text":"inner","loc":4090},"4092":{"type":"list","values":[4094,4095,5071],"loc":4092},"4094":{"type":"identifier","text":"pprim","loc":4094},"4095":{"type":"identifier","text":"prim","loc":4095},"4105":{"type":"string","first":4137,"templates":[{"expr":4224,"suffix":4225},{"expr":4905,"suffix":4139},{"expr":4140,"suffix":4141}],"loc":4105},"4129":{"type":"list","values":[4130,4131,5073],"loc":4129},"4130":{"type":"identifier","text":"pvar","loc":4130},"4131":{"type":"identifier","text":"name","loc":4131},"4132":{"type":"string","first":4160,"templates":[{"expr":4472,"suffix":4162},{"expr":4228,"suffix":4229},{"expr":4163,"suffix":4164}],"loc":4132},"4133":{"type":"identifier","text":"target","loc":4133},"4134":{"type":"identifier","text":"inner","loc":4134},"4137":{"type":"stringText","loc":4137,"text":"if ("},"4139":{"type":"stringText","text":") {\\n","loc":4139},"4140":{"type":"identifier","text":"inner","loc":4140},"4141":{"type":"stringText","text":"\\n}","loc":4141},"4148":{"type":"list","values":[4152,4153,5072],"loc":4148},"4149":{"type":"list","values":[4150,4151,5058],"loc":4149},"4150":{"type":"identifier","text":"pstr","loc":4150},"4151":{"type":"identifier","text":"string","loc":4151},"4152":{"type":"identifier","text":"pstr","loc":4152},"4153":{"type":"identifier","text":"str","loc":4153},"4154":{"type":"string","first":4155,"templates":[{"expr":4230,"suffix":4231},{"expr":4156,"suffix":4157},{"expr":4158,"suffix":4159}],"loc":4154},"4155":{"type":"stringText","loc":4155,"text":"if ("},"4156":{"type":"identifier","text":"str","loc":4156},"4157":{"type":"stringText","text":"\\\"){\\n","loc":4157},"4158":{"type":"identifier","text":"inner","loc":4158},"4159":{"type":"stringText","text":"\\n}","loc":4159},"4160":{"type":"stringText","loc":4160,"text":"{\\nlet "},"4161":{"type":"identifier","text":"name","loc":4161},"4162":{"type":"stringText","text":" = ","loc":4162},"4163":{"type":"identifier","text":"inner","loc":4163},"4164":{"type":"stringText","text":"\\n}","loc":4164},"4165":{"type":"list","values":[4166,4167,5303,4168,5074],"loc":4165},"4166":{"type":"identifier","text":"pcon","loc":4166},"4167":{"type":"identifier","text":"name","loc":4167},"4168":{"type":"identifier","text":"args","loc":4168},"4170":{"type":"blank","loc":4170},"4224":{"type":"identifier","text":"target","loc":4224},"4225":{"type":"stringText","text":" === ","loc":4225},"4228":{"type":"identifier","text":"target","loc":4228},"4229":{"type":"stringText","text":";\\n","loc":4229},"4230":{"type":"identifier","text":"target","loc":4230},"4231":{"type":"stringText","text":" === \\\"","loc":4231},"4247":{"type":"stringText","loc":4247,"text":""},"4251":{"type":"list","values":[4253,4280,4254,4257],"loc":4251},"4253":{"type":"identifier","text":"defn","loc":4253},"4254":{"type":"array","values":[4255,4302,4256,4281],"loc":4254},"4255":{"type":"identifier","text":"target","loc":4255},"4256":{"type":"identifier","text":"i","loc":4256},"4257":{"type":"list","values":[4258,4259,4260,4261,4262,4268],"loc":4257},"4258":{"type":"identifier","text":"match","loc":4258},"4259":{"type":"identifier","text":"args","loc":4259},"4260":{"type":"array","values":[],"loc":4260},"4261":{"type":"identifier","text":"inner","loc":4261},"4262":{"type":"array","values":[4263,4267],"loc":4262},"4263":{"type":"identifier","text":"arg","loc":4263},"4264":{"type":"identifier","text":"rest","loc":4264},"4267":{"type":"spread","contents":4264,"loc":4267},"4268":{"type":"list","values":[4269,4270,4271,4273],"loc":4268},"4269":{"type":"identifier","text":"compile-pat-naive","loc":4269},"4270":{"type":"identifier","text":"arg","loc":4270},"4271":{"type":"string","first":4272,"templates":[{"expr":4297,"suffix":4298},{"expr":4903,"suffix":4296}],"loc":4271},"4272":{"type":"stringText","loc":4272,"text":""},"4273":{"type":"list","values":[4274,4275,4301,4276,4282],"loc":4273},"4274":{"type":"identifier","text":"pat-loop","loc":4274},"4275":{"type":"identifier","text":"target","loc":4275},"4276":{"type":"list","values":[4277,4278,4279],"loc":4276},"4277":{"type":"identifier","text":"+","loc":4277},"4278":{"type":"identifier","text":"i","loc":4278},"4279":{"type":"identifier","text":"1","loc":4279},"4280":{"type":"identifier","text":"pat-loop","loc":4280},"4281":{"type":"identifier","text":"inner","loc":4281},"4282":{"type":"identifier","text":"inner","loc":4282},"4283":{"type":"string","first":4284,"templates":[{"expr":4285,"suffix":4286},{"expr":4287,"suffix":4288},{"expr":4289,"suffix":4290}],"loc":4283},"4284":{"type":"stringText","loc":4284,"text":"if ("},"4285":{"type":"identifier","text":"target","loc":4285},"4286":{"type":"stringText","text":".type === \\\"","loc":4286},"4287":{"type":"identifier","text":"name","loc":4287},"4288":{"type":"stringText","text":"\\\") {\\n","loc":4288},"4289":{"type":"list","values":[4291,4914,4292,4293,4294],"loc":4289},"4290":{"type":"stringText","text":"\\n}","loc":4290},"4291":{"type":"identifier","text":"pat-loop","loc":4291},"4292":{"type":"identifier","text":"args","loc":4292},"4293":{"type":"identifier","text":"0","loc":4293},"4294":{"type":"identifier","text":"inner","loc":4294},"4295":{"type":"identifier","text":"int-to-string","loc":4295},"4296":{"type":"stringText","text":"]","loc":4296},"4297":{"type":"identifier","text":"target","loc":4297},"4298":{"type":"stringText","text":"[","loc":4298},"4301":{"type":"identifier","text":"rest","loc":4301},"4302":{"type":"identifier","text":"args","loc":4302},"4314":{"type":"string","first":4317,"templates":[{"expr":4362,"suffix":4324},{"expr":4318,"suffix":4319}],"loc":4314},"4317":{"type":"stringText","loc":4317,"text":"(($target) => {\\n"},"4318":{"type":"list","values":[4321,4322],"loc":4318},"4319":{"type":"stringText","text":")","loc":4319},"4321":{"type":"identifier","text":"compile","loc":4321},"4322":{"type":"identifier","text":"target","loc":4322},"4323":{"type":"list","values":[4325,4326,4334],"loc":4323},"4324":{"type":"stringText","text":"\\nthrow new Error('Failed to match. ' + valueToString($target));\\n})(","loc":4324},"4325":{"type":"identifier","text":"map","loc":4325},"4326":{"type":"identifier","text":"cases","loc":4326},"4334":{"type":"list","values":[4335,4336,4340],"loc":4334},"4335":{"type":"identifier","text":"fn","loc":4335},"4336":{"type":"array","values":[4338],"loc":4336},"4338":{"type":"identifier","text":"case","loc":4338},"4340":{"type":"list","values":[4341,4343,4348],"loc":4340},"4341":{"type":"identifier","text":"let","loc":4341},"4343":{"type":"array","values":[4344,4349],"loc":4343},"4344":{"type":"list","values":[4345,4346,4347],"loc":4344},"4345":{"type":"identifier","text":",","loc":4345},"4346":{"type":"identifier","text":"pat","loc":4346},"4347":{"type":"identifier","text":"body","loc":4347},"4348":{"type":"list","values":[4352,4353,4354,4356],"loc":4348},"4349":{"type":"identifier","text":"case","loc":4349},"4352":{"type":"identifier","text":"compile-pat","loc":4352},"4353":{"type":"identifier","text":"pat","loc":4353},"4354":{"type":"string","first":4355,"templates":[],"loc":4354},"4355":{"type":"stringText","loc":4355,"text":"$target"},"4356":{"type":"string","first":4357,"templates":[{"expr":4358,"suffix":4359}],"loc":4356},"4357":{"type":"stringText","loc":4357,"text":"return "},"4358":{"type":"list","values":[4360,4361],"loc":4358},"4359":{"type":"stringText","text":"","loc":4359},"4360":{"type":"identifier","text":"compile","loc":4360},"4361":{"type":"identifier","text":"body","loc":4361},"4362":{"type":"list","values":[4363,4376,6035],"loc":4362},"4363":{"type":"identifier","text":"join","loc":4363},"4376":{"type":"string","first":4377,"templates":[],"loc":4376},"4377":{"type":"stringText","loc":4377,"text":"\\n"},"4378":{"type":"list","values":[4379,4381,4382,4915],"loc":4378},"4379":{"type":"identifier","text":"estr","loc":4379},"4381":{"type":"identifier","text":"first","loc":4381},"4382":{"type":"identifier","text":"tpls","loc":4382},"4436":{"type":"list","values":[4437,4438,4439],"loc":4436},"4437":{"type":"identifier","text":",","loc":4437},"4438":{"type":"list","values":[4440,4441],"loc":4438},"4439":{"type":"string","first":4445,"templates":[],"loc":4439},"4440":{"type":"identifier","text":"@","loc":4440},"4441":{"type":"string","first":4442,"templates":[{"expr":4443,"suffix":4444}],"loc":4441},"4442":{"type":"stringText","loc":4442,"text":"a"},"4443":{"type":"identifier","text":"2","loc":4443},"4444":{"type":"stringText","text":"b","loc":4444},"4445":{"type":"stringText","loc":4445,"text":"a2b"},"4446":{"type":"list","values":[4447,4450,4451,4452,4460,6301],"loc":4446},"4447":{"type":"identifier","text":"match","loc":4447},"4450":{"type":"identifier","text":"tpls","loc":4450},"4451":{"type":"array","values":[],"loc":4451},"4452":{"type":"string","first":4453,"templates":[{"expr":4454,"suffix":4455}],"loc":4452},"4453":{"type":"stringText","loc":4453,"text":"\\\""},"4454":{"type":"list","values":[4456,6300],"loc":4454},"4455":{"type":"stringText","text":"\\\"","loc":4455},"4456":{"type":"identifier","text":"fix-slashes","loc":4456},"4460":{"type":"identifier","text":"_","loc":4460},"4472":{"type":"list","values":[4473,4161],"loc":4472},"4473":{"type":"identifier","text":"sanitize","loc":4473},"4474":{"type":"list","values":[4475,4476,4478],"loc":4474},"4475":{"type":"identifier","text":",","loc":4475},"4476":{"type":"string","first":4477,"templates":[],"loc":4476},"4477":{"type":"stringText","loc":4477,"text":"`"},"4478":{"type":"string","first":4479,"templates":[],"loc":4478},"4479":{"type":"stringText","loc":4479,"text":"\\\\`"},"4480":{"type":"list","values":[4481,4482,4484],"loc":4480},"4481":{"type":"identifier","text":",","loc":4481},"4482":{"type":"string","first":4483,"templates":[],"loc":4482},"4483":{"type":"stringText","loc":4483,"text":"$"},"4484":{"type":"string","first":4485,"templates":[],"loc":4484},"4485":{"type":"stringText","loc":4485,"text":"\\\\$"},"4486":{"type":"list","values":[4487,4488,4489],"loc":4486},"4487":{"type":"identifier","text":",","loc":4487},"4488":{"type":"list","values":[4490,4491],"loc":4488},"4489":{"type":"string","first":4495,"templates":[],"loc":4489},"4490":{"type":"identifier","text":"@","loc":4490},"4491":{"type":"string","first":4492,"templates":[{"expr":4493,"suffix":4494}],"loc":4491},"4492":{"type":"stringText","loc":4492,"text":"`"},"4493":{"type":"identifier","text":"1","loc":4493},"4494":{"type":"stringText","text":"","loc":4494},"4495":{"type":"stringText","loc":4495,"text":"`1"},"4496":{"type":"list","values":[4497,4498,4499],"loc":4496},"4497":{"type":"identifier","text":",","loc":4497},"4498":{"type":"list","values":[4500,4501],"loc":4498},"4499":{"type":"string","first":4505,"templates":[],"loc":4499},"4500":{"type":"identifier","text":"@","loc":4500},"4501":{"type":"string","first":4502,"templates":[{"expr":4503,"suffix":4504}],"loc":4501},"4502":{"type":"stringText","loc":4502,"text":"${"},"4503":{"type":"identifier","text":"1","loc":4503},"4504":{"type":"stringText","text":"","loc":4504},"4505":{"type":"stringText","loc":4505,"text":"${1"},"4707":{"type":"blank","loc":4707},"4714":{"type":"list","values":[4715,4077,4716,4717,6610],"loc":4714},"4715":{"type":"identifier","text":"eval","loc":4715},"4716":{"type":"identifier","text":"compile","loc":4716},"4717":{"type":"identifier","text":"compile-top","loc":4717},"4719":{"type":"identifier","text":"_","loc":4719},"4720":{"loc":4720,"type":"list","values":[4723,4724,4725,4726,4730,4731,4742,4743,4747,4748,4752,4753,4760,4761,4768,4769,4779,4780]},"4723":{"loc":4723,"type":"identifier","text":"deftype"},"4724":{"loc":4724,"type":"identifier","text":"expr"},"4725":{"loc":4725,"type":"rich-text","contents":[{"id":"75ea0e27-8491-4efb-b875-9d2233bc7ed0","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"the trailing ","styles":{}},{"type":"text","text":"int","styles":{"code":true}},{"type":"text","text":" on each constructor is a unique id","styles":{}}],"children":[]}]},"4726":{"loc":4726,"type":"list","values":[4727,4728,4729]},"4727":{"loc":4727,"type":"identifier","text":"eprim"},"4728":{"loc":4728,"type":"identifier","text":"prim"},"4729":{"loc":4729,"type":"identifier","text":"int"},"4730":{"loc":4730,"type":"rich-text","contents":[{"id":"89460e23-49ae-4caf-bff2-fc9d477df677","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"estr: prefix,","styles":{"code":true}},{"type":"text","text":" ","styles":{}},{"type":"text","text":"template-pairs","styles":{"code":true}},{"type":"text","text":". All strings are template strings in our language :)","styles":{}}],"children":[]},{"id":"028918e5-425e-4d4a-b35f-992292f48576","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"So ","styles":{}},{"type":"text","text":"\"Hello ${world}!\"","styles":{"code":true}},{"type":"text","text":" would parse into\n","styles":{}},{"type":"text","text":"(estr \"Hello\" [(,, (evar \"world\") \"!\" 1234)])","styles":{"code":true}}],"children":[]},{"id":"fb11b2cc-0be0-4dee-8f90-107d8ca0301d","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"template-pairs","styles":{"code":true}},{"type":"text","text":" is a list of ","styles":{}},{"type":"text","text":"expression","styles":{"code":true}},{"type":"text","text":" and ","styles":{}},{"type":"text","text":"suffix","styles":{"code":true}},{"type":"text","text":" (with a unique ID for the string tacked on)","styles":{}}],"children":[]}]},"4731":{"loc":4731,"type":"list","values":[4732,4733,4734,4741]},"4732":{"loc":4732,"type":"identifier","text":"estr"},"4733":{"loc":4733,"type":"identifier","text":"string"},"4734":{"loc":4734,"type":"list","values":[4735,4736]},"4735":{"loc":4735,"type":"identifier","text":"list"},"4736":{"loc":4736,"type":"list","values":[4737,4738,4739,4740]},"4737":{"loc":4737,"type":"identifier","text":","},"4738":{"loc":4738,"type":"identifier","text":"expr"},"4739":{"loc":4739,"type":"identifier","text":"string"},"4740":{"loc":4740,"type":"identifier","text":"int"},"4741":{"loc":4741,"type":"identifier","text":"int"},"4742":{"loc":4742,"type":"rich-text","contents":[{"id":"17ad6efe-42d4-4d27-9c51-3c5d78e9c338","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"evar:","styles":{"code":true}},{"type":"text","text":" a variable reference! might be local or global","styles":{}}],"children":[]}]},"4743":{"loc":4743,"type":"list","values":[4744,4745,4746]},"4744":{"loc":4744,"type":"identifier","text":"evar"},"4745":{"loc":4745,"type":"identifier","text":"string"},"4746":{"loc":4746,"type":"identifier","text":"int"},"4747":{"loc":4747,"type":"rich-text","contents":[{"id":"61920579-0e52-48f6-a04d-3a1001c53b81","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"equot:","styles":{"code":true}},{"type":"text","text":" this form allows embedding of the CST or AST into the runtime, which makes writing tests for our parsers, compilers, and type checkers much simpler.","styles":{}}],"children":[]}]},"4748":{"loc":4748,"type":"list","values":[4749,4750,4751]},"4749":{"loc":4749,"type":"identifier","text":"equot"},"4750":{"loc":4750,"type":"identifier","text":"quot"},"4751":{"loc":4751,"type":"identifier","text":"int"},"4752":{"loc":4752,"type":"rich-text","contents":[{"id":"a22d06e1-f3b8-4ea5-9495-8008c09cc659","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"elambda: args, body","styles":{"code":true}},{"type":"text","text":", parsed from the form ","styles":{}},{"type":"text","text":"(fn [arg1 arg2] body)","styles":{"code":true}},{"type":"text","text":".","styles":{}}],"children":[]}]},"4753":{"loc":4753,"type":"list","values":[4754,4755,4758,4759]},"4754":{"loc":4754,"type":"identifier","text":"elambda"},"4755":{"loc":4755,"type":"list","values":[4756,4757]},"4756":{"loc":4756,"type":"identifier","text":"list"},"4757":{"loc":4757,"type":"identifier","text":"pat"},"4758":{"loc":4758,"type":"identifier","text":"expr"},"4759":{"loc":4759,"type":"identifier","text":"int"},"4760":{"loc":4760,"type":"rich-text","contents":[{"id":"95bf6267-a00d-4526-9030-a36a7626bc44","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"eapp: target, args","styles":{"code":true}}],"children":[]}]},"4761":{"loc":4761,"type":"list","values":[4762,4763,4764,4767]},"4762":{"loc":4762,"type":"identifier","text":"eapp"},"4763":{"loc":4763,"type":"identifier","text":"expr"},"4764":{"loc":4764,"type":"list","values":[4765,4766]},"4765":{"loc":4765,"type":"identifier","text":"list"},"4766":{"loc":4766,"type":"identifier","text":"expr"},"4767":{"loc":4767,"type":"identifier","text":"int"},"4768":{"loc":4768,"type":"rich-text","contents":[{"id":"03be29ee-aeb9-4157-948a-b659a7695f1e","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"elet: bindings, body","styles":{"code":true}}],"children":[]}]},"4769":{"loc":4769,"type":"list","values":[4770,4771,4777,4778]},"4770":{"loc":4770,"type":"identifier","text":"elet"},"4771":{"loc":4771,"type":"list","values":[4772,4773]},"4772":{"loc":4772,"type":"identifier","text":"list"},"4773":{"loc":4773,"type":"list","values":[4774,4775,4776]},"4774":{"loc":4774,"type":"identifier","text":","},"4775":{"loc":4775,"type":"identifier","text":"pat"},"4776":{"loc":4776,"type":"identifier","text":"expr"},"4777":{"loc":4777,"type":"identifier","text":"expr"},"4778":{"loc":4778,"type":"identifier","text":"int"},"4779":{"loc":4779,"type":"rich-text","contents":[{"id":"49a25799-d29e-4727-bdd7-a7f1aa12c8f3","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"ematch: target, cases","styles":{"code":true}}],"children":[]}]},"4780":{"loc":4780,"type":"list","values":[4781,4782,4783,5279]},"4781":{"loc":4781,"type":"identifier","text":"ematch"},"4782":{"loc":4782,"type":"identifier","text":"expr"},"4783":{"loc":4783,"type":"list","values":[4784,4785]},"4784":{"loc":4784,"type":"identifier","text":"list"},"4785":{"loc":4785,"type":"list","values":[4786,4787,4788]},"4786":{"loc":4786,"type":"identifier","text":","},"4787":{"loc":4787,"type":"identifier","text":"pat"},"4788":{"loc":4788,"type":"identifier","text":"expr"},"4789":{"loc":4789,"type":"list","values":[4790,4791,4792,4795,4798,4801,4804]},"4790":{"loc":4790,"type":"identifier","text":"deftype"},"4791":{"loc":4791,"type":"identifier","text":"quot"},"4792":{"loc":4792,"type":"list","values":[4793,4794]},"4793":{"loc":4793,"type":"identifier","text":"quot/expr"},"4794":{"loc":4794,"type":"identifier","text":"expr"},"4795":{"loc":4795,"type":"list","values":[4796,4797]},"4796":{"loc":4796,"type":"identifier","text":"quot/top"},"4797":{"loc":4797,"type":"identifier","text":"top"},"4798":{"loc":4798,"type":"list","values":[4799,4800]},"4799":{"loc":4799,"type":"identifier","text":"quot/type"},"4800":{"loc":4800,"type":"identifier","text":"type"},"4801":{"loc":4801,"type":"list","values":[4802,4803]},"4802":{"loc":4802,"type":"identifier","text":"quot/pat"},"4803":{"loc":4803,"type":"identifier","text":"pat"},"4804":{"loc":4804,"type":"list","values":[4805,4806]},"4805":{"loc":4805,"type":"identifier","text":"quot/quot"},"4806":{"loc":4806,"type":"identifier","text":"cst"},"4808":{"type":"string","first":4809,"templates":[{"expr":4812,"suffix":4813},{"expr":4810,"suffix":4811},{"expr":4814,"suffix":4815}],"loc":4808},"4809":{"type":"stringText","loc":4809,"text":""},"4810":{"type":"identifier","text":"sep","loc":4810},"4811":{"type":"stringText","text":"","loc":4811},"4812":{"type":"identifier","text":"one","loc":4812},"4813":{"type":"stringText","text":"","loc":4813},"4814":{"type":"list","values":[4816,4817,4818],"loc":4814},"4815":{"type":"stringText","text":"","loc":4815},"4816":{"type":"identifier","text":"join","loc":4816},"4817":{"type":"identifier","text":"sep","loc":4817},"4818":{"type":"identifier","text":"rest","loc":4818},"4819":{"type":"list","values":[4821,4822,4823,4827,4833,4839,4845,4849],"loc":4819},"4821":{"type":"identifier","text":"deftype","loc":4821},"4822":{"type":"identifier","text":"cst","loc":4822},"4823":{"type":"list","values":[4824,4825,4826],"loc":4823},"4824":{"type":"identifier","text":"cst/identifier","loc":4824},"4825":{"type":"identifier","text":"string","loc":4825},"4826":{"type":"identifier","text":"int","loc":4826},"4827":{"type":"list","values":[4828,4829,4832],"loc":4827},"4828":{"type":"identifier","text":"cst/list","loc":4828},"4829":{"type":"list","values":[4830,4831],"loc":4829},"4830":{"type":"identifier","text":"list","loc":4830},"4831":{"type":"identifier","text":"cst","loc":4831},"4832":{"type":"identifier","text":"int","loc":4832},"4833":{"type":"list","values":[4834,4835,4838],"loc":4833},"4834":{"type":"identifier","text":"cst/array","loc":4834},"4835":{"type":"list","values":[4836,4837],"loc":4835},"4836":{"type":"identifier","text":"list","loc":4836},"4837":{"type":"identifier","text":"cst","loc":4837},"4838":{"type":"identifier","text":"int","loc":4838},"4839":{"type":"list","values":[4840,4841,4844],"loc":4839},"4840":{"type":"identifier","text":"cst/record","loc":4840},"4841":{"type":"list","values":[4842,4843],"loc":4841},"4842":{"type":"identifier","text":"list","loc":4842},"4843":{"type":"identifier","text":"cst","loc":4843},"4844":{"type":"identifier","text":"int","loc":4844},"4845":{"type":"list","values":[4846,4847,4848],"loc":4845},"4846":{"type":"identifier","text":"cst/spread","loc":4846},"4847":{"type":"identifier","text":"cst","loc":4847},"4848":{"type":"identifier","text":"int","loc":4848},"4849":{"type":"list","values":[4850,4851,4852,4859],"loc":4849},"4850":{"type":"identifier","text":"cst/string","loc":4850},"4851":{"type":"identifier","text":"string","loc":4851},"4852":{"type":"list","values":[4853,4854],"loc":4852},"4853":{"type":"identifier","text":"list","loc":4853},"4854":{"type":"list","values":[4855,4856,4857,4858],"loc":4854},"4855":{"type":"identifier","text":",","loc":4855},"4856":{"type":"identifier","text":"cst","loc":4856},"4857":{"type":"identifier","text":"string","loc":4857},"4858":{"type":"identifier","text":"int","loc":4858},"4859":{"type":"identifier","text":"int","loc":4859},"4901":{"type":"identifier","text":"int","loc":4901},"4903":{"type":"list","values":[4295,4904],"loc":4903},"4904":{"type":"identifier","text":"i","loc":4904},"4905":{"type":"list","values":[5384,5385],"loc":4905},"4914":{"type":"identifier","text":"target","loc":4914},"4915":{"type":"identifier","text":"_","loc":4915},"4916":{"type":"identifier","text":"_","loc":4916},"4917":{"type":"identifier","text":"_","loc":4917},"4918":{"type":"identifier","text":"_","loc":4918},"4919":{"type":"identifier","text":"_","loc":4919},"4920":{"type":"identifier","text":"_","loc":4920},"4921":{"type":"identifier","text":"_","loc":4921},"4922":{"type":"identifier","text":"_","loc":4922},"4923":{"type":"recordAccess","target":4420,"items":[4924],"loc":4923},"4924":{"type":"accessText","text":"","loc":4924},"4926":{"type":"list","values":[4928,4929,4930,4932],"loc":4926},"4928":{"type":"identifier","text":"defn","loc":4928},"4929":{"type":"identifier","text":"pat-as-arg-inner","loc":4929},"4930":{"type":"array","values":[4931],"loc":4930},"4931":{"type":"identifier","text":"pat","loc":4931},"4932":{"type":"list","values":[4933,4934,4935,4937,4939,4942,4943,4958,4959,4962,4965,5010,5048,5049],"loc":4932},"4933":{"type":"identifier","text":"match","loc":4933},"4934":{"type":"identifier","text":"pat","loc":4934},"4935":{"type":"list","values":[4936,5075],"loc":4935},"4936":{"type":"identifier","text":"pany","loc":4936},"4937":{"type":"identifier","text":"none","loc":4937},"4938":{"type":"stringText","loc":4938,"text":""},"4939":{"type":"list","values":[4940,4941,5076],"loc":4939},"4940":{"type":"identifier","text":"pprim","loc":4940},"4941":{"type":"identifier","text":"_","loc":4941},"4942":{"type":"identifier","text":"none","loc":4942},"4943":{"type":"list","values":[4956,4957,5077],"loc":4943},"4956":{"type":"identifier","text":"pstr","loc":4956},"4957":{"type":"identifier","text":"_","loc":4957},"4958":{"type":"identifier","text":"none","loc":4958},"4959":{"type":"list","values":[4960,4961,5053],"loc":4959},"4960":{"type":"identifier","text":"pvar","loc":4960},"4961":{"type":"identifier","text":"name","loc":4961},"4962":{"type":"list","values":[4963,5227],"loc":4962},"4963":{"type":"identifier","text":"some","loc":4963},"4964":{"type":"identifier","text":"sanitize","loc":4964},"4965":{"type":"list","values":[4966,4967,5304,4968,5054],"loc":4965},"4966":{"type":"identifier","text":"pcon","loc":4966},"4967":{"type":"identifier","text":"_","loc":4967},"4968":{"type":"identifier","text":"args","loc":4968},"4969":{"type":"list","values":[4970,4971,4975,4977],"loc":4969},"4970":{"type":"identifier","text":"foldl","loc":4970},"4971":{"type":"list","values":[4972,4973,4974],"loc":4971},"4972":{"type":"identifier","text":",","loc":4972},"4973":{"type":"identifier","text":"0","loc":4973},"4974":{"type":"array","values":[],"loc":4974},"4975":{"type":"identifier","text":"args","loc":4975},"4977":{"type":"list","values":[4978,4979,5004],"loc":4977},"4978":{"type":"identifier","text":"fn","loc":4978},"4979":{"type":"array","values":[4980,4984],"loc":4979},"4980":{"type":"list","values":[4981,4982,4983],"loc":4980},"4981":{"type":"identifier","text":",","loc":4981},"4982":{"type":"identifier","text":"i","loc":4982},"4983":{"type":"identifier","text":"res","loc":4983},"4984":{"type":"identifier","text":"arg","loc":4984},"4985":{"type":"list","values":[4986,4987,4990,4992,4995,4998],"loc":4985},"4986":{"type":"identifier","text":"match","loc":4986},"4987":{"type":"list","values":[4988,4989],"loc":4987},"4988":{"type":"identifier","text":"pat-as-arg-inner","loc":4988},"4989":{"type":"identifier","text":"arg","loc":4989},"4990":{"type":"list","values":[4991],"loc":4990},"4991":{"type":"identifier","text":"none","loc":4991},"4992":{"type":"identifier","text":"res","loc":4992},"4995":{"type":"list","values":[4996,4997],"loc":4995},"4996":{"type":"identifier","text":"some","loc":4996},"4997":{"type":"identifier","text":"arg","loc":4997},"4998":{"type":"array","values":[5031,5003],"loc":4998},"4999":{"type":"identifier","text":"arg","loc":4999},"5000":{"type":"identifier","text":"res","loc":5000},"5003":{"type":"spread","contents":5000,"loc":5003},"5004":{"type":"list","values":[5005,5006,4985],"loc":5004},"5005":{"type":"identifier","text":",","loc":5005},"5006":{"type":"list","values":[5007,5008,5009],"loc":5006},"5007":{"type":"identifier","text":"+","loc":5007},"5008":{"type":"identifier","text":"i","loc":5008},"5009":{"type":"identifier","text":"1","loc":5009},"5010":{"type":"list","values":[5011,4969,5016,5013,5019,5015],"loc":5010},"5011":{"type":"identifier","text":"match","loc":5011},"5012":{"type":"array","values":[],"loc":5012},"5013":{"type":"identifier","text":"none","loc":5013},"5014":{"type":"identifier","text":",","loc":5014},"5015":{"type":"list","values":[5022,5023],"loc":5015},"5016":{"type":"list","values":[5017,5018,5012],"loc":5016},"5017":{"type":"identifier","text":",","loc":5017},"5018":{"type":"identifier","text":"_","loc":5018},"5019":{"type":"list","values":[5014,5020,5021],"loc":5019},"5020":{"type":"identifier","text":"_","loc":5020},"5021":{"type":"identifier","text":"args","loc":5021},"5022":{"type":"identifier","text":"some","loc":5022},"5023":{"type":"string","first":5024,"templates":[{"expr":5025,"suffix":5026}],"loc":5023},"5024":{"type":"stringText","loc":5024,"text":"{"},"5025":{"type":"list","values":[5027,5028,5030],"loc":5025},"5026":{"type":"stringText","text":"}","loc":5026},"5027":{"type":"identifier","text":"join","loc":5027},"5028":{"type":"string","first":5029,"templates":[],"loc":5028},"5029":{"type":"stringText","loc":5029,"text":", "},"5030":{"type":"identifier","text":"args","loc":5030},"5031":{"type":"string","first":5032,"templates":[{"expr":5034,"suffix":5035},{"expr":4999,"suffix":5033}],"loc":5031},"5032":{"type":"stringText","loc":5032,"text":""},"5033":{"type":"stringText","loc":5033,"text":""},"5034":{"type":"list","values":[5036,5037],"loc":5034},"5035":{"type":"stringText","text":": ","loc":5035},"5036":{"type":"identifier","text":"int-to-string","loc":5036},"5037":{"type":"identifier","text":"i","loc":5037},"5048":{"type":"identifier","text":"_","loc":5048},"5049":{"type":"list","values":[5050,5051],"loc":5049},"5050":{"type":"identifier","text":"fatal","loc":5050},"5051":{"type":"string","first":5052,"templates":[{"expr":5240,"suffix":5239}],"loc":5051},"5052":{"type":"stringText","loc":5052,"text":"No pat "},"5053":{"type":"identifier","text":"_","loc":5053},"5054":{"type":"identifier","text":"_","loc":5054},"5055":{"type":"identifier","text":"int","loc":5055},"5056":{"type":"identifier","text":"int","loc":5056},"5057":{"type":"identifier","text":"int","loc":5057},"5058":{"type":"identifier","text":"int","loc":5058},"5059":{"type":"identifier","text":"int","loc":5059},"5060":{"type":"identifier","text":"int","loc":5060},"5061":{"type":"identifier","text":"int","loc":5061},"5062":{"type":"identifier","text":"int","loc":5062},"5063":{"type":"identifier","text":"int","loc":5063},"5064":{"type":"identifier","text":"int","loc":5064},"5065":{"type":"identifier","text":"int","loc":5065},"5066":{"type":"identifier","text":"_","loc":5066},"5068":{"type":"identifier","text":"_","loc":5068},"5069":{"type":"identifier","text":"_","loc":5069},"5070":{"type":"identifier","text":"_","loc":5070},"5071":{"type":"identifier","text":"_","loc":5071},"5072":{"type":"identifier","text":"_","loc":5072},"5073":{"type":"identifier","text":"_","loc":5073},"5074":{"type":"identifier","text":"_","loc":5074},"5075":{"type":"identifier","text":"_","loc":5075},"5076":{"type":"identifier","text":"_","loc":5076},"5077":{"type":"identifier","text":"_","loc":5077},"5099":{"type":"comment-node","loc":5099,"contents":4244},"5116":{"type":"list","values":[5118,5119,5120,5125],"loc":5116},"5118":{"type":"identifier","text":"defn","loc":5118},"5119":{"type":"identifier","text":"maybe-parens","loc":5119},"5120":{"type":"array","values":[5123,5124],"loc":5120},"5122":{"type":"blank","loc":5122},"5123":{"type":"identifier","text":"inner","loc":5123},"5124":{"type":"identifier","text":"parens","loc":5124},"5125":{"type":"list","values":[5126,5127,5128,5132],"loc":5125},"5126":{"type":"identifier","text":"if","loc":5126},"5127":{"type":"identifier","text":"parens","loc":5127},"5128":{"type":"string","first":5129,"templates":[{"expr":5130,"suffix":5131}],"loc":5128},"5129":{"type":"stringText","loc":5129,"text":"("},"5130":{"type":"identifier","text":"inner","loc":5130},"5131":{"type":"stringText","text":")","loc":5131},"5132":{"type":"identifier","text":"inner","loc":5132},"5133":{"type":"list","values":[5135,5136,5137,5139],"loc":5133},"5135":{"type":"identifier","text":"defn","loc":5135},"5136":{"type":"identifier","text":"needs-parens","loc":5136},"5137":{"type":"array","values":[5138],"loc":5137},"5138":{"type":"identifier","text":"expr","loc":5138},"5139":{"type":"list","values":[5140,5141,5142,5147,5148,5152,5153,5154],"loc":5139},"5140":{"type":"identifier","text":"match","loc":5140},"5141":{"type":"identifier","text":"expr","loc":5141},"5142":{"type":"list","values":[5143,5144,5145,5146],"loc":5142},"5143":{"type":"identifier","text":"elambda","loc":5143},"5144":{"type":"identifier","text":"_","loc":5144},"5145":{"type":"identifier","text":"_","loc":5145},"5146":{"type":"identifier","text":"_","loc":5146},"5147":{"type":"identifier","text":"true","loc":5147},"5148":{"type":"list","values":[5149,5150,5151],"loc":5148},"5149":{"type":"identifier","text":"eprim","loc":5149},"5150":{"type":"identifier","text":"_","loc":5150},"5151":{"type":"identifier","text":"_","loc":5151},"5152":{"type":"identifier","text":"true","loc":5152},"5153":{"type":"identifier","text":"_","loc":5153},"5154":{"type":"identifier","text":"false","loc":5154},"5155":{"type":"list","values":[5157,5159,5160,5163],"loc":5155},"5157":{"type":"identifier","text":"defn","loc":5157},"5159":{"type":"identifier","text":"with-parens","loc":5159},"5160":{"type":"array","values":[5161],"loc":5160},"5161":{"type":"identifier","text":"expr","loc":5161},"5163":{"type":"list","values":[5164,5165,5166],"loc":5163},"5164":{"type":"identifier","text":"maybe-parens","loc":5164},"5165":{"type":"list","values":[5176,5177],"loc":5165},"5166":{"type":"list","values":[5167,5168],"loc":5166},"5167":{"type":"identifier","text":"needs-parens","loc":5167},"5168":{"type":"identifier","text":"expr","loc":5168},"5169":{"type":"comment-node","loc":5169,"contents":1840},"5170":{"type":"list","values":[5171,5172],"loc":5170},"5171":{"type":"identifier","text":"with-parens","loc":5171},"5172":{"type":"identifier","text":"f","loc":5172},"5176":{"type":"identifier","text":"compile","loc":5176},"5177":{"type":"identifier","text":"expr","loc":5177},"5181":{"type":"list","values":[5182,5170,5183,5184],"loc":5181},"5182":{"type":"identifier","text":"foldl","loc":5182},"5183":{"type":"identifier","text":"args","loc":5183},"5184":{"type":"list","values":[5185,5186,5189],"loc":5184},"5185":{"type":"identifier","text":"fn","loc":5185},"5186":{"type":"array","values":[5187,5188],"loc":5186},"5187":{"type":"identifier","text":"target","loc":5187},"5188":{"type":"identifier","text":"arg","loc":5188},"5189":{"type":"string","first":5190,"templates":[{"expr":5191,"suffix":5192},{"expr":5193,"suffix":5194}],"loc":5189},"5190":{"type":"stringText","loc":5190,"text":""},"5191":{"type":"identifier","text":"target","loc":5191},"5192":{"type":"stringText","text":"(","loc":5192},"5193":{"type":"list","values":[5195,5196],"loc":5193},"5194":{"type":"stringText","text":")","loc":5194},"5195":{"type":"identifier","text":"compile","loc":5195},"5196":{"type":"identifier","text":"arg","loc":5196},"5197":{"type":"comment-node","loc":5197,"contents":1816},"5198":{"type":"list","values":[5199,5200,5203,5204],"loc":5198},"5199":{"type":"identifier","text":"foldr","loc":5199},"5200":{"type":"list","values":[5201,5202],"loc":5200},"5201":{"type":"identifier","text":"compile","loc":5201},"5202":{"type":"identifier","text":"body","loc":5202},"5203":{"type":"identifier","text":"bindings","loc":5203},"5204":{"type":"list","values":[5205,5206,5214,5218],"loc":5204},"5205":{"type":"identifier","text":"fn","loc":5205},"5206":{"type":"array","values":[5207,5208],"loc":5206},"5207":{"type":"identifier","text":"body","loc":5207},"5208":{"type":"list","values":[5209,5212,5213],"loc":5208},"5209":{"type":"identifier","text":",","loc":5209},"5212":{"type":"identifier","text":"pat","loc":5212},"5213":{"type":"identifier","text":"init","loc":5213},"5214":{"type":"string","first":5215,"templates":[{"expr":5219,"suffix":5217},{"expr":5221,"suffix":5222},{"expr":5223,"suffix":5224}],"loc":5214},"5215":{"type":"stringText","loc":5215,"text":"(("},"5216":{"type":"identifier","text":"pat-as-arg","loc":5216},"5217":{"type":"stringText","text":") => ","loc":5217},"5218":{"type":"blank","loc":5218},"5219":{"type":"list","values":[5216,5220],"loc":5219},"5220":{"type":"identifier","text":"pat","loc":5220},"5221":{"type":"identifier","text":"body","loc":5221},"5222":{"type":"stringText","text":")(","loc":5222},"5223":{"type":"list","values":[5225,5226],"loc":5223},"5224":{"type":"stringText","text":")","loc":5224},"5225":{"type":"identifier","text":"compile","loc":5225},"5226":{"type":"identifier","text":"init","loc":5226},"5227":{"type":"list","values":[4964,5228],"loc":5227},"5228":{"type":"identifier","text":"name","loc":5228},"5229":{"type":"list","values":[1804,1805],"loc":5229},"5230":{"type":"blank","loc":5230},"5238":{"type":"identifier","text":"jsonify","loc":5238},"5239":{"type":"stringText","text":"","loc":5239},"5240":{"type":"list","values":[5238,5241],"loc":5240},"5241":{"type":"identifier","text":"pat","loc":5241},"5242":{"type":"list","values":[5243,5244,5247,5248],"loc":5242},"5243":{"type":"identifier","text":"foldr","loc":5243},"5244":{"type":"list","values":[5245,5246],"loc":5244},"5245":{"type":"identifier","text":"compile","loc":5245},"5246":{"type":"identifier","text":"body","loc":5246},"5247":{"type":"identifier","text":"pats","loc":5247},"5248":{"type":"list","values":[5249,5250,1801],"loc":5248},"5249":{"type":"identifier","text":"fn","loc":5249},"5250":{"type":"array","values":[5251,5252],"loc":5250},"5251":{"type":"identifier","text":"body","loc":5251},"5252":{"type":"identifier","text":"pat","loc":5252},"5268":{"type":"list","values":[5219],"loc":5268},"5269":{"type":"blank","loc":5269},"5279":{"type":"identifier","text":"int","loc":5279},"5299":{"type":"list","values":[5280],"loc":5299},"5300":{"type":"blank","loc":5300},"5302":{"type":"identifier","text":"int","loc":5302},"5303":{"type":"identifier","text":"_","loc":5303},"5304":{"type":"identifier","text":"_","loc":5304},"5305":{"type":"list","values":[5307,5308,5309,5311],"loc":5305},"5307":{"type":"identifier","text":"defn","loc":5307},"5308":{"type":"identifier","text":"compile-quot","loc":5308},"5309":{"type":"array","values":[5310],"loc":5309},"5310":{"type":"identifier","text":"quot","loc":5310},"5311":{"type":"list","values":[5312,5313,5314,5317,5320,5323,5326,5329,5333,5336,5339,5342],"loc":5311},"5312":{"type":"identifier","text":"match","loc":5312},"5313":{"type":"identifier","text":"quot","loc":5313},"5314":{"type":"list","values":[5315,5316],"loc":5314},"5315":{"type":"identifier","text":"quot/quot","loc":5315},"5316":{"type":"identifier","text":"x","loc":5316},"5317":{"type":"list","values":[5318,5319],"loc":5317},"5318":{"type":"identifier","text":"jsonify","loc":5318},"5319":{"type":"identifier","text":"x","loc":5319},"5320":{"type":"list","values":[5321,5322],"loc":5320},"5321":{"type":"identifier","text":"quot/expr","loc":5321},"5322":{"type":"identifier","text":"x","loc":5322},"5323":{"type":"list","values":[5324,5325],"loc":5323},"5324":{"type":"identifier","text":"jsonify","loc":5324},"5325":{"type":"identifier","text":"x","loc":5325},"5326":{"type":"list","values":[5327,5328],"loc":5326},"5327":{"type":"identifier","text":"quot/top","loc":5327},"5328":{"type":"identifier","text":"x","loc":5328},"5329":{"type":"list","values":[5330,5331],"loc":5329},"5330":{"type":"identifier","text":"jsonify","loc":5330},"5331":{"type":"identifier","text":"x","loc":5331},"5333":{"type":"list","values":[5334,5335],"loc":5333},"5334":{"type":"identifier","text":"quot/pat","loc":5334},"5335":{"type":"identifier","text":"x","loc":5335},"5336":{"type":"list","values":[5337,5338],"loc":5336},"5337":{"type":"identifier","text":"jsonify","loc":5337},"5338":{"type":"identifier","text":"x","loc":5338},"5339":{"type":"list","values":[5340,5341],"loc":5339},"5340":{"type":"identifier","text":"quot/type","loc":5340},"5341":{"type":"identifier","text":"x","loc":5341},"5342":{"type":"list","values":[5343,5344],"loc":5342},"5343":{"type":"identifier","text":"jsonify","loc":5343},"5344":{"type":"identifier","text":"x","loc":5344},"5345":{"type":"identifier","text":"compile-quot","loc":5345},"5346":{"type":"identifier","text":"inner","loc":5346},"5347":{"type":"list","values":[5348,5349,5355],"loc":5347},"5348":{"type":"identifier","text":",","loc":5348},"5349":{"type":"list","values":[5351,5352],"loc":5349},"5350":{"type":"blank","loc":5350},"5351":{"type":"identifier","text":"@","loc":5351},"5352":{"type":"list","values":[5353,5354],"loc":5352},"5353":{"type":"identifier","text":"@","loc":5353},"5354":{"type":"identifier","text":"1","loc":5354},"5355":{"type":"list","values":[5356,5357,5361],"loc":5355},"5356":{"type":"identifier","text":"eprim","loc":5356},"5357":{"type":"list","values":[5358,5359,5360],"loc":5357},"5358":{"type":"identifier","text":"pint","loc":5358},"5359":{"type":"identifier","text":"1","loc":5359},"5360":{"type":"identifier","text":"5354","loc":5360},"5361":{"type":"identifier","text":"5354","loc":5361},"5378":{"type":"identifier","text":"int","loc":5378},"5379":{"type":"identifier","text":"int","loc":5379},"5380":{"type":"identifier","text":"_","loc":5380},"5381":{"type":"identifier","text":"_","loc":5381},"5384":{"type":"identifier","text":"compile-prim","loc":5384},"5385":{"type":"identifier","text":"prim","loc":5385},"5386":{"type":"identifier","text":"compile-prim","loc":5386},"5387":{"type":"list","values":[5386,5388],"loc":5387},"5388":{"type":"identifier","text":"prim","loc":5388},"5389":{"type":"list","values":[5390,5391,5392,1752],"loc":5389},"5390":{"type":"identifier","text":"defn","loc":5390},"5391":{"type":"identifier","text":"compile-prim","loc":5391},"5392":{"type":"array","values":[5393],"loc":5392},"5393":{"type":"identifier","text":"prim","loc":5393},"5395":{"type":"rich-text","contents":[{"id":"afa6adc7-2d89-46a1-9cc8-326d14fbdab2","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":1},"content":[{"type":"text","text":"Self-Hosted Code Generation","styles":{}}],"children":[]}],"loc":5395},"5397":{"type":"rich-text","contents":[{"id":"c94feae2-6826-4d74-94c7-f0902538a429","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"So the tree-walking interpreter was very simple to implement, but it's extremely slow 😴 So for the self-hosted compiler, we'll be doing code generation! It'll speed up execution of the parser & code generator by a factor of 10-20x!","styles":{}}],"children":[]},{"id":"beb85612-019f-4ea9-8a51-2816fb4d422d","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"We're still going for simplicity though, so our compilation target will be JavaScript :). With automatic garbage collection, flexible objects, and permissive type system, not to mention the excellent in-browser debugging tools, JavaScript makes for a very forgiving compilation target.","styles":{}}],"children":[]},{"id":"62363f3e-f8ca-48d2-af0c-7994a3b6c7dd","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"Maybe later we'll implement code generation for something a little closer to the metal, like chicken scheme ","styles":{}},{"type":"text","text":"cough","styles":{"italic":true}},{"type":"text","text":" I mean golang.","styles":{}}],"children":[]}],"loc":5397},"5399":{"type":"rich-text","contents":[{"id":"96c15c2b-3b8e-49c5-a000-7eb495e0e24b","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"We saw this before in the bootstrap, so feel free to skip. It's included here for completeness, and because the code wouldn't run without it 😉.","styles":{}}],"children":[]}],"loc":5399},"5401":{"type":"comment-node","loc":5401,"contents":4870},"5402":{"type":"comment-node","loc":5402,"contents":3130},"5403":{"type":"string","first":5404,"templates":[{"expr":5405,"suffix":5406},{"expr":5407,"suffix":5408}],"loc":5403},"5404":{"type":"stringText","loc":5404,"text":"({type: \\\""},"5405":{"type":"identifier","text":"name","loc":5405},"5406":{"type":"stringText","text":"\\\"","loc":5406},"5407":{"type":"list","values":[5409,5410,5412],"loc":5407},"5408":{"type":"stringText","text":"})","loc":5408},"5409":{"type":"identifier","text":"join","loc":5409},"5410":{"type":"string","first":5411,"templates":[],"loc":5410},"5411":{"type":"stringText","loc":5411,"text":""},"5412":{"type":"list","values":[5413,5414,5415,5416],"loc":5412},"5413":{"type":"identifier","text":"mapi","loc":5413},"5414":{"type":"identifier","text":"0","loc":5414},"5415":{"type":"identifier","text":"args","loc":5415},"5416":{"type":"list","values":[5417,5418,5421],"loc":5416},"5417":{"type":"identifier","text":"fn","loc":5417},"5418":{"type":"array","values":[5419,5420],"loc":5418},"5419":{"type":"identifier","text":"i","loc":5419},"5420":{"type":"identifier","text":"arg","loc":5420},"5421":{"type":"string","first":5422,"templates":[{"expr":5423,"suffix":5424},{"expr":5432,"suffix":5433}],"loc":5421},"5422":{"type":"stringText","loc":5422,"text":", "},"5423":{"type":"list","values":[5425,5426],"loc":5423},"5424":{"type":"stringText","text":": ","loc":5424},"5425":{"type":"identifier","text":"int-to-string","loc":5425},"5426":{"type":"identifier","text":"i","loc":5426},"5427":{"type":"annot","target":5423,"annot":5428,"loc":5427},"5428":{"type":"blank","loc":5428},"5432":{"type":"identifier","text":"arg","loc":5432},"5433":{"type":"stringText","text":"","loc":5433},"5434":{"type":"list","values":[5436,5437],"loc":5434},"5435":{"type":"stringText","text":" = ","loc":5435},"5436":{"type":"identifier","text":"sanitize","loc":5436},"5437":{"type":"identifier","text":"name","loc":5437},"5438":{"type":"list","values":[5440,5442],"loc":5438},"5439":{"type":"stringText","text":";\\n","loc":5439},"5440":{"type":"identifier","text":"compile","loc":5440},"5442":{"type":"identifier","text":"body","loc":5442},"5443":{"type":"comment-node","loc":5443,"contents":2230},"5444":{"type":"string","first":5445,"templates":[{"expr":5446,"suffix":5447},{"expr":5450,"suffix":5451},{"expr":5470,"suffix":5471}],"loc":5444},"5445":{"type":"stringText","loc":5445,"text":"const "},"5446":{"type":"list","values":[5448,5449],"loc":5446},"5447":{"type":"stringText","text":" = ","loc":5447},"5448":{"type":"identifier","text":"sanitize","loc":5448},"5449":{"type":"identifier","text":"name","loc":5449},"5450":{"type":"identifier","text":"arrows","loc":5450},"5451":{"type":"stringText","text":"","loc":5451},"5452":{"type":"identifier","text":"join","loc":5452},"5453":{"type":"string","first":5454,"templates":[],"loc":5453},"5454":{"loc":5454,"type":"stringText","text":""},"5455":{"loc":5455,"type":"list","values":[]},"5456":{"type":"identifier","text":"map","loc":5456},"5457":{"type":"blank","loc":5457},"5458":{"type":"identifier","text":"indices","loc":5458},"5459":{"loc":5459,"type":"list","values":[]},"5460":{"type":"identifier","text":"fn","loc":5460},"5461":{"loc":5461,"type":"array","values":[]},"5462":{"type":"identifier","text":"i","loc":5462},"5464":{"loc":5464,"type":"string","first":5465,"templates":[]},"5465":{"loc":5465,"type":"stringText","text":""},"5466":{"loc":5466,"type":"list","values":[]},"5467":{"type":"stringText","text":") => ","loc":5467},"5468":{"type":"identifier","text":"int-to-string","loc":5468},"5469":{"type":"identifier","text":"i","loc":5469},"5470":{"type":"identifier","text":"body","loc":5470},"5471":{"type":"stringText","text":"","loc":5471},"5472":{"type":"identifier","text":"literal-constr","loc":5472},"5473":{"type":"identifier","text":"name","loc":5473},"5474":{"loc":5474,"type":"list","values":[]},"5475":{"type":"identifier","text":"mapi","loc":5475},"5476":{"type":"identifier","text":"0","loc":5476},"5477":{"type":"identifier","text":"args","loc":5477},"5478":{"loc":5478,"type":"list","values":[]},"5479":{"type":"identifier","text":"fn","loc":5479},"5480":{"loc":5480,"type":"array","values":[]},"5482":{"type":"identifier","text":"i","loc":5482},"5483":{"type":"identifier","text":"_","loc":5483},"5484":{"loc":5484,"type":"list","values":[]},"5485":{"type":"identifier","text":"int-to-string","loc":5485},"5486":{"type":"identifier","text":"i","loc":5486},"5487":{"type":"blank","loc":5487},"5488":{"loc":5488,"type":"string","first":5489,"templates":[]},"5489":{"loc":5489,"type":"stringText","text":""},"5490":{"type":"stringText","loc":5490,"text":""},"5491":{"type":"blank","loc":5491},"5492":{"type":"list","values":[5494,5496,5497,5501],"loc":5492},"5494":{"type":"identifier","text":"defn","loc":5494},"5496":{"type":"identifier","text":"indices","loc":5496},"5497":{"type":"array","values":[5506],"loc":5497},"5499":{"type":"blank","loc":5499},"5501":{"type":"list","values":[5502,5504,5505,5507],"loc":5501},"5502":{"type":"identifier","text":"mapi","loc":5502},"5504":{"type":"identifier","text":"0","loc":5504},"5505":{"type":"identifier","text":"lst","loc":5505},"5506":{"type":"identifier","text":"lst","loc":5506},"5507":{"type":"list","values":[5508,5509,5512],"loc":5507},"5508":{"type":"identifier","text":"fn","loc":5508},"5509":{"type":"array","values":[5510,5511],"loc":5509},"5510":{"type":"identifier","text":"i","loc":5510},"5511":{"type":"identifier","text":"_","loc":5511},"5512":{"type":"identifier","text":"i","loc":5512},"5513":{"type":"comment-node","loc":5513,"contents":5412},"5522":{"loc":5522,"type":"list","values":[]},"5523":{"type":"identifier","text":"args","loc":5523},"5524":{"type":"identifier","text":"arrows","loc":5524},"5525":{"type":"blank","loc":5525},"5526":{"loc":5526,"type":"list","values":[5527,5528,5530]},"5527":{"loc":5527,"type":"identifier","text":"join"},"5528":{"loc":5528,"type":"string","first":5529,"templates":[]},"5529":{"loc":5529,"type":"stringText","text":""},"5530":{"loc":5530,"type":"list","values":[5531,5532,5535]},"5531":{"loc":5531,"type":"identifier","text":"map"},"5532":{"loc":5532,"type":"list","values":[5533,5534]},"5533":{"loc":5533,"type":"identifier","text":"indices"},"5534":{"loc":5534,"type":"identifier","text":"args"},"5535":{"loc":5535,"type":"list","values":[5536,5537,5539]},"5536":{"loc":5536,"type":"identifier","text":"fn"},"5537":{"loc":5537,"type":"array","values":[5538]},"5538":{"loc":5538,"type":"identifier","text":"i"},"5539":{"loc":5539,"type":"string","first":5540,"templates":[{"expr":5541,"suffix":5544}]},"5540":{"loc":5540,"type":"stringText","text":"(v"},"5541":{"loc":5541,"type":"list","values":[5542,5543]},"5542":{"loc":5542,"type":"identifier","text":"int-to-string"},"5543":{"loc":5543,"type":"identifier","text":"i"},"5544":{"loc":5544,"type":"stringText","text":") => "},"5546":{"type":"identifier","text":"body","loc":5546},"5547":{"type":"blank","loc":5547},"5548":{"loc":5548,"type":"list","values":[5549,5550,5551]},"5549":{"type":"identifier","text":"constructor-fn","loc":5549},"5550":{"loc":5550,"type":"identifier","text":"name"},"5551":{"loc":5551,"type":"list","values":[5552,5566,5555]},"5552":{"loc":5552,"type":"identifier","text":"map"},"5553":{"loc":5553,"type":"identifier","text":"indices"},"5555":{"loc":5555,"type":"list","values":[5556,5557,5560]},"5556":{"loc":5556,"type":"identifier","text":"fn"},"5557":{"loc":5557,"type":"array","values":[5558]},"5558":{"loc":5558,"type":"identifier","text":"i"},"5560":{"loc":5560,"type":"string","first":5561,"templates":[{"expr":5562,"suffix":5565}]},"5561":{"loc":5561,"type":"stringText","text":"v"},"5562":{"loc":5562,"type":"list","values":[5563,5564]},"5563":{"loc":5563,"type":"identifier","text":"int-to-string"},"5564":{"loc":5564,"type":"identifier","text":"i"},"5565":{"loc":5565,"type":"stringText","text":""},"5566":{"type":"list","values":[5553,5567],"loc":5566},"5567":{"type":"identifier","text":"args","loc":5567},"5568":{"type":"identifier","text":"fn","loc":5568},"5569":{"type":"array","values":[5570],"loc":5569},"5570":{"type":"identifier","text":"v","loc":5570},"5571":{"type":"blank","loc":5571},"5572":{"loc":5572,"type":"list","values":[5573,5574]},"5573":{"loc":5573,"type":"identifier","text":"eval-with-builtins"},"5574":{"loc":5574,"type":"list","values":[5575,5576]},"5575":{"loc":5575,"type":"identifier","text":"compile"},"5576":{"loc":5576,"type":"identifier","text":"v"},"5577":{"type":"list","values":[5579,5580,5581],"loc":5577},"5579":{"type":"identifier","text":",","loc":5579},"5580":{"type":"identifier","text":"pat-as-arg-inner","loc":5580},"5581":{"type":"array","values":[5582,5595,5604,5629,6213],"loc":5581},"5582":{"type":"list","values":[5583,5584,5591],"loc":5582},"5583":{"type":"identifier","text":",","loc":5583},"5584":{"type":"list","values":[5585,5586],"loc":5584},"5585":{"type":"identifier","text":"@p","loc":5585},"5586":{"type":"list","values":[5587,5588,5589],"loc":5586},"5587":{"type":"identifier","text":",","loc":5587},"5588":{"type":"identifier","text":"a","loc":5588},"5589":{"type":"identifier","text":"_","loc":5589},"5590":{"type":"blank","loc":5590},"5591":{"type":"list","values":[5592,5593],"loc":5591},"5592":{"type":"identifier","text":"some","loc":5592},"5593":{"type":"string","first":5594,"templates":[],"loc":5593},"5594":{"type":"stringText","text":"{0: a}","loc":5594},"5595":{"type":"list","values":[5596,5597,5602],"loc":5595},"5596":{"type":"identifier","text":",","loc":5596},"5597":{"type":"list","values":[5599,5601],"loc":5597},"5598":{"type":"blank","loc":5598},"5599":{"type":"identifier","text":"@p","loc":5599},"5601":{"type":"identifier","text":"_","loc":5601},"5602":{"type":"list","values":[5603],"loc":5602},"5603":{"type":"identifier","text":"none","loc":5603},"5604":{"type":"list","values":[5605,5606,5625],"loc":5604},"5605":{"type":"identifier","text":",","loc":5605},"5606":{"type":"list","values":[5608,5610],"loc":5606},"5607":{"type":"blank","loc":5607},"5608":{"type":"identifier","text":"@p","loc":5608},"5610":{"type":"array","values":[5611,5620,5615],"loc":5610},"5611":{"type":"identifier","text":"a","loc":5611},"5612":{"type":"identifier","text":"rest","loc":5612},"5615":{"type":"spread","contents":5612,"loc":5615},"5616":{"type":"blank","loc":5616},"5620":{"type":"identifier","text":"2","loc":5620},"5621":{"type":"blank","loc":5621},"5625":{"type":"list","values":[5626,5627],"loc":5625},"5626":{"type":"identifier","text":"some","loc":5626},"5627":{"type":"string","first":5628,"templates":[],"loc":5627},"5628":{"type":"stringText","text":"{1: {1: rest}, 0: a}","loc":5628},"5629":{"type":"list","values":[5630,5631,5637],"loc":5629},"5630":{"type":"identifier","text":",","loc":5630},"5631":{"type":"list","values":[5635,5636],"loc":5631},"5632":{"type":"blank","loc":5632},"5635":{"type":"identifier","text":"@p","loc":5635},"5636":{"type":"identifier","text":"arg","loc":5636},"5637":{"type":"list","values":[5638,5639],"loc":5637},"5638":{"type":"identifier","text":"some","loc":5638},"5639":{"type":"string","first":5640,"templates":[],"loc":5639},"5640":{"type":"stringText","text":"arg","loc":5640},"5660":{"type":"list","values":[5662,5663,5664,5667],"loc":5660},"5662":{"type":"identifier","text":"defn","loc":5662},"5663":{"type":"identifier","text":"compile-pat-list","loc":5663},"5664":{"type":"array","values":[5665,5666],"loc":5664},"5665":{"type":"identifier","text":"pat","loc":5665},"5666":{"type":"identifier","text":"target","loc":5666},"5667":{"type":"list","values":[5668,5669,5670,5896,5675,5899,5693,5903,5709,5906,5726,5913],"loc":5667},"5668":{"type":"identifier","text":"match","loc":5668},"5669":{"type":"identifier","text":"pat","loc":5669},"5670":{"type":"list","values":[5671,5672],"loc":5670},"5671":{"type":"identifier","text":"pany","loc":5671},"5672":{"type":"identifier","text":"_","loc":5672},"5673":{"type":"array","values":[],"loc":5673},"5675":{"type":"list","values":[5676,5677,5678],"loc":5675},"5676":{"type":"identifier","text":"pprim","loc":5676},"5677":{"type":"identifier","text":"prim","loc":5677},"5678":{"type":"identifier","text":"_","loc":5678},"5680":{"type":"blank","loc":5680},"5683":{"type":"blank","loc":5683},"5684":{"type":"string","first":5685,"templates":[{"expr":5686,"suffix":5687},{"expr":5688,"suffix":5689}],"loc":5684},"5685":{"type":"stringText","loc":5685,"text":""},"5686":{"type":"identifier","text":"target","loc":5686},"5687":{"type":"stringText","text":" === ","loc":5687},"5688":{"type":"list","values":[5691,5692],"loc":5688},"5689":{"type":"stringText","text":"","loc":5689},"5691":{"type":"identifier","text":"compile-prim","loc":5691},"5692":{"type":"identifier","text":"prim","loc":5692},"5693":{"type":"list","values":[5694,5695,5696],"loc":5693},"5694":{"type":"identifier","text":"pstr","loc":5694},"5695":{"type":"identifier","text":"str","loc":5695},"5696":{"type":"identifier","text":"_","loc":5696},"5698":{"type":"blank","loc":5698},"5700":{"type":"blank","loc":5700},"5701":{"type":"string","first":5702,"templates":[{"expr":5703,"suffix":5704},{"expr":5707,"suffix":5708}],"loc":5701},"5702":{"type":"stringText","loc":5702,"text":""},"5703":{"type":"identifier","text":"target","loc":5703},"5704":{"type":"stringText","text":" === \\\"","loc":5704},"5707":{"type":"identifier","text":"str","loc":5707},"5708":{"type":"stringText","text":"\\\"","loc":5708},"5709":{"type":"list","values":[5710,5711,5712],"loc":5709},"5710":{"type":"identifier","text":"pvar","loc":5710},"5711":{"type":"identifier","text":"name","loc":5711},"5712":{"type":"identifier","text":"_","loc":5712},"5714":{"type":"blank","loc":5714},"5716":{"type":"blank","loc":5716},"5717":{"type":"string","first":5719,"templates":[{"expr":5720,"suffix":5721},{"expr":5724,"suffix":5725}],"loc":5717},"5719":{"type":"stringText","loc":5719,"text":"let "},"5720":{"type":"list","values":[5722,5723],"loc":5720},"5721":{"type":"stringText","text":" = ","loc":5721},"5722":{"type":"identifier","text":"sanitize","loc":5722},"5723":{"type":"identifier","text":"name","loc":5723},"5724":{"type":"identifier","text":"target","loc":5724},"5725":{"type":"stringText","text":";","loc":5725},"5726":{"type":"list","values":[5727,5728,5729,5730,5894],"loc":5726},"5727":{"type":"identifier","text":"pcon","loc":5727},"5728":{"type":"identifier","text":"name","loc":5728},"5729":{"type":"identifier","text":"_","loc":5729},"5730":{"type":"identifier","text":"args","loc":5730},"5731":{"type":"array","values":[5785,5795],"loc":5731},"5732":{"type":"array","values":[5684],"loc":5732},"5733":{"type":"array","values":[5701],"loc":5733},"5734":{"type":"array","values":[5717],"loc":5734},"5737":{"type":"list","values":[5739,5740,5741,5743],"loc":5737},"5739":{"type":"identifier","text":"defn","loc":5739},"5740":{"type":"identifier","text":"concat","loc":5740},"5741":{"type":"array","values":[5742],"loc":5741},"5742":{"type":"identifier","text":"lsts","loc":5742},"5743":{"type":"list","values":[5744,5745,5746,5748,5749,5751,5885,5891,5752,5773],"loc":5743},"5744":{"type":"identifier","text":"match","loc":5744},"5745":{"type":"identifier","text":"lsts","loc":5745},"5746":{"type":"array","values":[],"loc":5746},"5748":{"type":"array","values":[],"loc":5748},"5749":{"type":"array","values":[5759],"loc":5749},"5751":{"type":"identifier","text":"one","loc":5751},"5752":{"type":"array","values":[5753,5769],"loc":5752},"5753":{"type":"array","values":[5754,5758],"loc":5753},"5754":{"type":"identifier","text":"one","loc":5754},"5755":{"type":"identifier","text":"rest","loc":5755},"5758":{"type":"spread","contents":5755,"loc":5758},"5759":{"type":"identifier","text":"one","loc":5759},"5766":{"type":"identifier","text":"lsts","loc":5766},"5769":{"type":"spread","contents":5766,"loc":5769},"5770":{"type":"list","values":[5771,5772],"loc":5770},"5771":{"type":"identifier","text":"concat","loc":5771},"5772":{"type":"array","values":[5777,5781],"loc":5772},"5773":{"type":"array","values":[5774,5776],"loc":5773},"5774":{"type":"identifier","text":"one","loc":5774},"5776":{"type":"spread","loc":5776,"contents":5770},"5777":{"type":"identifier","text":"rest","loc":5777},"5778":{"type":"identifier","text":"lsts","loc":5778},"5781":{"type":"spread","contents":5778,"loc":5781},"5784":{"type":"blank","loc":5784},"5785":{"type":"string","first":5786,"templates":[{"expr":5787,"suffix":5788},{"expr":5789,"suffix":5790}],"loc":5785},"5786":{"type":"stringText","loc":5786,"text":""},"5787":{"type":"identifier","text":"target","loc":5787},"5788":{"type":"stringText","text":".type === \\\"","loc":5788},"5789":{"type":"identifier","text":"name","loc":5789},"5790":{"type":"stringText","text":"\\\"","loc":5790},"5792":{"type":"identifier","text":"check","loc":5792},"5795":{"type":"spread","contents":5792,"loc":5795},"5806":{"type":"list","values":[5808,5809,5810,5816],"loc":5806},"5808":{"type":"identifier","text":"defn","loc":5808},"5809":{"type":"identifier","text":"pat-loop-list","loc":5809},"5810":{"type":"array","values":[5813,5814,5815],"loc":5810},"5812":{"type":"blank","loc":5812},"5813":{"type":"identifier","text":"target","loc":5813},"5814":{"type":"identifier","text":"args","loc":5814},"5815":{"type":"identifier","text":"i","loc":5815},"5816":{"type":"list","values":[5817,5818,5819,5820,5821,5855],"loc":5816},"5817":{"type":"identifier","text":"match","loc":5817},"5818":{"type":"identifier","text":"args","loc":5818},"5819":{"type":"array","values":[],"loc":5819},"5820":{"type":"list","values":[5928,5929,5930],"loc":5820},"5821":{"type":"array","values":[5822,5826],"loc":5821},"5822":{"type":"identifier","text":"arg","loc":5822},"5823":{"type":"identifier","text":"rest","loc":5823},"5826":{"type":"spread","contents":5823,"loc":5826},"5827":{"type":"list","values":[5828,5829,5830],"loc":5827},"5828":{"type":"identifier","text":"compile-pat-list","loc":5828},"5829":{"type":"identifier","text":"arg","loc":5829},"5830":{"type":"string","first":5831,"templates":[{"expr":5832,"suffix":5833},{"expr":5834,"suffix":5835}],"loc":5830},"5831":{"type":"stringText","loc":5831,"text":""},"5832":{"type":"identifier","text":"target","loc":5832},"5833":{"type":"stringText","text":"[","loc":5833},"5834":{"type":"list","values":[5836,5837],"loc":5834},"5835":{"type":"stringText","text":"]","loc":5835},"5836":{"type":"identifier","text":"int-to-string","loc":5836},"5837":{"type":"identifier","text":"i","loc":5837},"5840":{"type":"list","values":[5950,5951,5956],"loc":5840},"5844":{"type":"spread","contents":5841,"loc":5844},"5855":{"type":"list","values":[5856,5931,5840],"loc":5855},"5856":{"type":"identifier","text":"let","loc":5856},"5885":{"type":"array","values":[5886,5890],"loc":5885},"5886":{"type":"array","values":[],"loc":5886},"5887":{"type":"identifier","text":"rest","loc":5887},"5890":{"type":"spread","contents":5887,"loc":5890},"5891":{"type":"list","values":[5892,5893],"loc":5891},"5892":{"type":"identifier","text":"concat","loc":5892},"5893":{"type":"identifier","text":"rest","loc":5893},"5894":{"type":"identifier","text":"_","loc":5894},"5896":{"type":"list","values":[5897,5898,5673],"loc":5896},"5897":{"type":"identifier","text":",","loc":5897},"5898":{"type":"array","values":[],"loc":5898},"5899":{"type":"list","values":[5900,5732,5902],"loc":5899},"5900":{"type":"identifier","text":",","loc":5900},"5902":{"type":"array","values":[],"loc":5902},"5903":{"type":"list","values":[5904,5733,5905],"loc":5903},"5904":{"type":"identifier","text":",","loc":5904},"5905":{"type":"array","values":[],"loc":5905},"5906":{"type":"list","values":[5907,5908,5734],"loc":5906},"5907":{"type":"identifier","text":",","loc":5907},"5908":{"type":"array","values":[],"loc":5908},"5909":{"type":"list","values":[5910,5731,5912],"loc":5909},"5910":{"type":"identifier","text":",","loc":5910},"5912":{"type":"identifier","text":"assign","loc":5912},"5913":{"type":"list","values":[5914,5915,5909],"loc":5913},"5914":{"type":"identifier","text":"let","loc":5914},"5915":{"type":"array","values":[5916,5920],"loc":5915},"5916":{"type":"list","values":[5917,5918,5919],"loc":5916},"5917":{"type":"identifier","text":",","loc":5917},"5918":{"type":"identifier","text":"check","loc":5918},"5919":{"type":"identifier","text":"assign","loc":5919},"5920":{"type":"list","values":[5921,5922,5923,5924],"loc":5920},"5921":{"type":"identifier","text":"pat-loop-list","loc":5921},"5922":{"type":"identifier","text":"target","loc":5922},"5923":{"type":"identifier","text":"args","loc":5923},"5924":{"type":"identifier","text":"0","loc":5924},"5927":{"type":"spread","contents":5792,"loc":5927},"5928":{"type":"identifier","text":",","loc":5928},"5929":{"type":"array","values":[],"loc":5929},"5930":{"type":"array","values":[],"loc":5930},"5931":{"type":"array","values":[5932,5827,5938,5942],"loc":5931},"5932":{"type":"list","values":[5933,5934,5935],"loc":5932},"5933":{"type":"identifier","text":",","loc":5933},"5934":{"type":"identifier","text":"check","loc":5934},"5935":{"type":"identifier","text":"assign","loc":5935},"5938":{"type":"list","values":[5939,5940,5941],"loc":5938},"5939":{"type":"identifier","text":",","loc":5939},"5940":{"type":"identifier","text":"c2","loc":5940},"5941":{"type":"identifier","text":"a2","loc":5941},"5942":{"type":"list","values":[5943,5944,5945,5946],"loc":5942},"5943":{"type":"identifier","text":"pat-loop-list","loc":5943},"5944":{"type":"identifier","text":"target","loc":5944},"5945":{"type":"identifier","text":"rest","loc":5945},"5946":{"type":"list","values":[5947,5948,5949],"loc":5946},"5947":{"type":"identifier","text":"+","loc":5947},"5948":{"type":"identifier","text":"i","loc":5948},"5949":{"type":"identifier","text":"1","loc":5949},"5950":{"type":"identifier","text":",","loc":5950},"5951":{"type":"list","values":[5952,5953],"loc":5951},"5952":{"type":"identifier","text":"concat","loc":5952},"5953":{"type":"array","values":[5954,5955],"loc":5953},"5954":{"type":"identifier","text":"check","loc":5954},"5955":{"type":"identifier","text":"c2","loc":5955},"5956":{"type":"list","values":[5957,5958],"loc":5956},"5957":{"type":"identifier","text":"concat","loc":5957},"5958":{"type":"array","values":[5959,5960],"loc":5958},"5959":{"type":"identifier","text":"assign","loc":5959},"5960":{"type":"identifier","text":"a2","loc":5960},"5961":{"type":"comment-node","loc":5961,"contents":4079},"5962":{"type":"list","values":[5964,5965,5967,5971],"loc":5962},"5964":{"type":"identifier","text":"defn","loc":5964},"5965":{"type":"identifier","text":"compile-pat","loc":5965},"5967":{"type":"array","values":[5968,5969,5970],"loc":5967},"5968":{"type":"identifier","text":"pat","loc":5968},"5969":{"type":"identifier","text":"target","loc":5969},"5970":{"type":"identifier","text":"inner","loc":5970},"5971":{"type":"list","values":[5972,5973,6007],"loc":5971},"5972":{"type":"identifier","text":"let","loc":5972},"5973":{"type":"array","values":[5974,5978,5986,5987,6008,6009],"loc":5973},"5974":{"type":"list","values":[5975,5976,5977],"loc":5974},"5975":{"type":"identifier","text":",","loc":5975},"5976":{"type":"identifier","text":"check","loc":5976},"5977":{"type":"identifier","text":"assign","loc":5977},"5978":{"type":"list","values":[5979,5980,5981],"loc":5978},"5979":{"type":"identifier","text":"compile-pat-list","loc":5979},"5980":{"type":"identifier","text":"pat","loc":5980},"5981":{"type":"identifier","text":"target","loc":5981},"5986":{"type":"identifier","text":"inner","loc":5986},"5987":{"type":"list","values":[5988,5989,5990,5991,5992,5993],"loc":5987},"5988":{"type":"identifier","text":"match","loc":5988},"5989":{"type":"identifier","text":"assign","loc":5989},"5990":{"type":"array","values":[],"loc":5990},"5991":{"type":"identifier","text":"inner","loc":5991},"5992":{"type":"identifier","text":"_","loc":5992},"5993":{"type":"string","first":5994,"templates":[{"expr":5995,"suffix":5996},{"expr":6005,"suffix":6006}],"loc":5993},"5994":{"type":"stringText","loc":5994,"text":"{\\n"},"5995":{"type":"list","values":[5997,6001,5998],"loc":5995},"5996":{"type":"stringText","text":"\\n","loc":5996},"5997":{"type":"identifier","text":"join","loc":5997},"5998":{"type":"identifier","text":"assign","loc":5998},"6000":{"type":"stringText","loc":6000,"text":""},"6001":{"type":"string","first":6002,"templates":[],"loc":6001},"6002":{"type":"stringText","loc":6002,"text":"\\n"},"6005":{"type":"identifier","text":"inner","loc":6005},"6006":{"type":"stringText","text":"\\n}","loc":6006},"6007":{"type":"identifier","text":"inner","loc":6007},"6008":{"type":"identifier","text":"inner","loc":6008},"6009":{"type":"list","values":[6010,6011,6012,6013,6014,6015],"loc":6009},"6010":{"type":"identifier","text":"match","loc":6010},"6011":{"type":"identifier","text":"check","loc":6011},"6012":{"type":"array","values":[],"loc":6012},"6013":{"type":"identifier","text":"inner","loc":6013},"6014":{"type":"identifier","text":"_","loc":6014},"6015":{"type":"string","first":6016,"templates":[{"expr":6017,"suffix":6018},{"expr":6026,"suffix":6027}],"loc":6015},"6016":{"type":"stringText","loc":6016,"text":"if ("},"6017":{"type":"list","values":[6019,6020,6023],"loc":6017},"6018":{"type":"stringText","text":") {\\n","loc":6018},"6019":{"type":"identifier","text":"join","loc":6019},"6020":{"type":"string","first":6022,"templates":[],"loc":6020},"6022":{"type":"stringText","loc":6022,"text":" &&\\n"},"6023":{"type":"identifier","text":"check","loc":6023},"6026":{"type":"identifier","text":"inner","loc":6026},"6027":{"type":"stringText","text":"\\n}","loc":6027},"6030":{"type":"list","values":[6031,6032,4314],"loc":6030},"6031":{"type":"identifier","text":"let","loc":6031},"6032":{"type":"array","values":[6033,4323,6034],"loc":6032},"6033":{"type":"identifier","text":"cases","loc":6033},"6034":{"type":"blank","loc":6034},"6035":{"type":"identifier","text":"cases","loc":6035},"6036":{"type":"list","values":[6038,6039,6042,6045],"loc":6036},"6038":{"type":"identifier","text":"deftype","loc":6038},"6039":{"type":"list","values":[6040,6041],"loc":6039},"6040":{"type":"identifier","text":"option","loc":6040},"6041":{"type":"identifier","text":"a","loc":6041},"6042":{"type":"list","values":[6043,6044],"loc":6042},"6043":{"type":"identifier","text":"some","loc":6043},"6044":{"type":"identifier","text":"a","loc":6044},"6045":{"type":"list","values":[6046],"loc":6045},"6046":{"type":"identifier","text":"none","loc":6046},"6047":{"type":"list","values":[6049,6050,6061],"loc":6047},"6049":{"type":"identifier","text":",","loc":6049},"6050":{"type":"list","values":[6051,6052,6057],"loc":6050},"6051":{"type":"identifier","text":"fn","loc":6051},"6052":{"type":"array","values":[6053],"loc":6052},"6053":{"type":"list","values":[6054,6055,6056],"loc":6053},"6054":{"type":"identifier","text":",","loc":6054},"6055":{"type":"identifier","text":"name","loc":6055},"6056":{"type":"identifier","text":"args","loc":6056},"6057":{"type":"list","values":[6058,6059,6060],"loc":6057},"6058":{"type":"identifier","text":"constructor-fn","loc":6058},"6059":{"type":"identifier","text":"name","loc":6059},"6060":{"type":"identifier","text":"args","loc":6060},"6061":{"type":"array","values":[6062,6070],"loc":6061},"6062":{"type":"list","values":[6063,6064,6074],"loc":6062},"6063":{"type":"identifier","text":",","loc":6063},"6064":{"type":"list","values":[6065,6066,6068],"loc":6064},"6065":{"type":"identifier","text":",","loc":6065},"6066":{"type":"string","first":6067,"templates":[],"loc":6066},"6067":{"type":"stringText","loc":6067,"text":"nil"},"6068":{"type":"array","values":[],"loc":6068},"6069":{"type":"blank","loc":6069},"6070":{"type":"list","values":[6071,6073,6085],"loc":6070},"6071":{"type":"identifier","text":",","loc":6071},"6073":{"type":"list","values":[6077,6078,6080],"loc":6073},"6074":{"type":"string","first":6075,"templates":[],"loc":6074},"6075":{"type":"stringText","text":"({type: \"nil\"})","loc":6075},"6076":{"type":"blank","loc":6076},"6077":{"type":"identifier","text":",","loc":6077},"6078":{"type":"string","first":6079,"templates":[],"loc":6078},"6079":{"type":"stringText","loc":6079,"text":"cons"},"6080":{"type":"array","values":[6081,6083],"loc":6080},"6081":{"type":"string","first":6082,"templates":[],"loc":6081},"6082":{"type":"stringText","loc":6082,"text":"10"},"6083":{"type":"string","first":6084,"templates":[],"loc":6083},"6084":{"type":"stringText","loc":6084,"text":"a"},"6085":{"type":"string","first":6086,"templates":[],"loc":6085},"6086":{"type":"stringText","text":"({type: \"cons\", 0: 10, 1: a})","loc":6086},"6087":{"type":"rich-text","contents":[{"id":"18df2b55-c48b-448d-82df-f4bd2a1e33aa","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":2},"content":[{"type":"text","text":"Patterns, done worse","styles":{}}],"children":[]}],"loc":6087},"6089":{"type":"list","values":[6091,6093,6101],"loc":6089},"6091":{"type":"identifier","text":",","loc":6091},"6092":{"type":"identifier","text":"fn","loc":6092},"6093":{"type":"list","values":[6092,6095,6097],"loc":6093},"6094":{"type":"identifier","text":"compile-pat-list","loc":6094},"6095":{"type":"array","values":[6096],"loc":6095},"6096":{"type":"identifier","text":"pat","loc":6096},"6097":{"type":"list","values":[6094,6098,6099],"loc":6097},"6098":{"type":"identifier","text":"pat","loc":6098},"6099":{"type":"string","first":6100,"templates":[],"loc":6099},"6100":{"type":"stringText","loc":6100,"text":"v"},"6101":{"type":"array","values":[6102,6115,6125],"loc":6101},"6102":{"type":"list","values":[6103,6104,6109],"loc":6102},"6103":{"type":"identifier","text":",","loc":6103},"6104":{"type":"list","values":[6106,6107],"loc":6104},"6106":{"type":"identifier","text":"@p","loc":6106},"6107":{"type":"identifier","text":"hi","loc":6107},"6108":{"type":"blank","loc":6108},"6109":{"type":"list","values":[6110,6111,6112],"loc":6109},"6110":{"type":"identifier","text":",","loc":6110},"6111":{"type":"array","values":[],"loc":6111},"6112":{"type":"array","values":[6113],"loc":6112},"6113":{"type":"string","first":6114,"templates":[],"loc":6113},"6114":{"type":"stringText","text":"let hi = v;","loc":6114},"6115":{"type":"list","values":[6116,6117,6121],"loc":6115},"6116":{"type":"identifier","text":",","loc":6116},"6117":{"type":"list","values":[6119,6120],"loc":6117},"6118":{"type":"blank","loc":6118},"6119":{"type":"identifier","text":"@p","loc":6119},"6120":{"type":"identifier","text":"_","loc":6120},"6121":{"type":"list","values":[6122,6123,6124],"loc":6121},"6122":{"type":"identifier","text":",","loc":6122},"6123":{"type":"array","values":[],"loc":6123},"6124":{"type":"array","values":[],"loc":6124},"6125":{"type":"list","values":[6126,6127,6142],"loc":6125},"6126":{"type":"identifier","text":",","loc":6126},"6127":{"type":"list","values":[6129,6130],"loc":6127},"6128":{"type":"blank","loc":6128},"6129":{"type":"identifier","text":"@p","loc":6129},"6130":{"type":"array","values":[6131,6132,6137,6141],"loc":6130},"6131":{"type":"identifier","text":"1","loc":6131},"6132":{"type":"list","values":[6133,6134,6136],"loc":6132},"6133":{"type":"identifier","text":"lol","loc":6133},"6134":{"type":"string","first":6135,"templates":[],"loc":6134},"6135":{"type":"stringText","loc":6135,"text":"hi"},"6136":{"type":"identifier","text":"x","loc":6136},"6137":{"type":"identifier","text":"23","loc":6137},"6138":{"type":"identifier","text":"rest","loc":6138},"6141":{"type":"spread","contents":6138,"loc":6141},"6142":{"type":"list","values":[6143,6144,6159],"loc":6142},"6143":{"type":"identifier","text":",","loc":6143},"6144":{"type":"array","values":[6145,6147,6149,6151,6153,6155,6157],"loc":6144},"6145":{"type":"string","first":6146,"templates":[],"loc":6145},"6146":{"type":"stringText","text":"v.type === \"cons\"","loc":6146},"6147":{"type":"string","first":6148,"templates":[],"loc":6147},"6148":{"type":"stringText","text":"v[0] === 1","loc":6148},"6149":{"type":"string","first":6150,"templates":[],"loc":6149},"6150":{"type":"stringText","text":"v[1].type === \"cons\"","loc":6150},"6151":{"type":"string","first":6152,"templates":[],"loc":6151},"6152":{"type":"stringText","text":"v[1][0].type === \"lol\"","loc":6152},"6153":{"type":"string","first":6154,"templates":[],"loc":6153},"6154":{"type":"stringText","text":"v[1][0][0] === \"hi\"","loc":6154},"6155":{"type":"string","first":6156,"templates":[],"loc":6155},"6156":{"type":"stringText","text":"v[1][1].type === \"cons\"","loc":6156},"6157":{"type":"string","first":6158,"templates":[],"loc":6157},"6158":{"type":"stringText","text":"v[1][1][0] === 23","loc":6158},"6159":{"type":"array","values":[6160,6162],"loc":6159},"6160":{"type":"string","first":6161,"templates":[],"loc":6160},"6161":{"type":"stringText","text":"let x = v[1][0][1];","loc":6161},"6162":{"type":"string","first":6163,"templates":[],"loc":6162},"6163":{"type":"stringText","text":"let rest = v[1][1][1];","loc":6163},"6164":{"type":"list","values":[6166,6167,6180],"loc":6164},"6166":{"type":"identifier","text":",","loc":6166},"6167":{"type":"list","values":[6170,6171,6173],"loc":6167},"6170":{"type":"identifier","text":"fn","loc":6170},"6171":{"type":"array","values":[6172],"loc":6171},"6172":{"type":"identifier","text":"pat","loc":6172},"6173":{"type":"list","values":[6174,6175,6176,6178],"loc":6173},"6174":{"type":"identifier","text":"compile-pat","loc":6174},"6175":{"type":"identifier","text":"pat","loc":6175},"6176":{"type":"string","first":6177,"templates":[],"loc":6176},"6177":{"type":"stringText","loc":6177,"text":"v"},"6178":{"type":"string","first":6179,"templates":[],"loc":6178},"6179":{"type":"stringText","loc":6179,"text":"// evaluation continues"},"6180":{"type":"array","values":[6181,6188,6195],"loc":6180},"6181":{"type":"list","values":[6182,6183,6186],"loc":6181},"6182":{"type":"identifier","text":",","loc":6182},"6183":{"type":"list","values":[6184,6185],"loc":6183},"6184":{"type":"identifier","text":"@p","loc":6184},"6185":{"type":"identifier","text":"_","loc":6185},"6186":{"type":"string","first":6187,"templates":[],"loc":6186},"6187":{"type":"stringText","loc":6187,"text":"// evaluation continues"},"6188":{"type":"list","values":[6189,6190,6199],"loc":6188},"6189":{"type":"identifier","text":",","loc":6189},"6190":{"type":"list","values":[6193,6194],"loc":6190},"6191":{"type":"blank","loc":6191},"6193":{"type":"identifier","text":"@p","loc":6193},"6194":{"type":"identifier","text":"name","loc":6194},"6195":{"type":"list","values":[6196,6197,6210],"loc":6195},"6196":{"type":"identifier","text":",","loc":6196},"6197":{"type":"list","values":[6201,6202],"loc":6197},"6198":{"type":"blank","loc":6198},"6199":{"type":"string","first":6200,"templates":[],"loc":6199},"6200":{"type":"stringText","text":"{\nlet name = v;\n// evaluation continues\n}","loc":6200},"6201":{"type":"identifier","text":"@p","loc":6201},"6202":{"type":"array","values":[6203,6204,6205,6206],"loc":6202},"6203":{"type":"identifier","text":"2","loc":6203},"6204":{"type":"identifier","text":"3","loc":6204},"6205":{"type":"identifier","text":"x","loc":6205},"6206":{"type":"list","values":[6207,6208,6209],"loc":6206},"6207":{"type":"identifier","text":"lol","loc":6207},"6208":{"type":"identifier","text":"2","loc":6208},"6209":{"type":"identifier","text":"y","loc":6209},"6210":{"type":"string","first":6211,"templates":[],"loc":6210},"6211":{"type":"stringText","text":"if (v.type === \"cons\" &&\nv[0] === 2 &&\nv[1].type === \"cons\" &&\nv[1][0] === 3 &&\nv[1][1].type === \"cons\" &&\nv[1][1][1].type === \"cons\" &&\nv[1][1][1][0].type === \"lol\" &&\nv[1][1][1][0][0] === 2 &&\nv[1][1][1][1].type === \"nil\") {\n{\nlet x = v[1][1][0];\nlet y = v[1][1][1][0][1];\n// evaluation continues\n}\n}","loc":6211},"6212":{"type":"blank","loc":6212},"6213":{"type":"list","values":[6214,6215,6220],"loc":6213},"6214":{"type":"identifier","text":",","loc":6214},"6215":{"type":"list","values":[6218,6219],"loc":6215},"6216":{"type":"blank","loc":6216},"6218":{"type":"identifier","text":"@p","loc":6218},"6219":{"type":"identifier","text":"case","loc":6219},"6220":{"type":"list","values":[6221,6222],"loc":6220},"6221":{"type":"identifier","text":"some","loc":6221},"6222":{"type":"string","first":6223,"templates":[],"loc":6222},"6223":{"type":"stringText","text":"$case","loc":6223},"6224":{"type":"rich-text","contents":[{"id":"be8c692e-7063-4574-b38a-248a782895b7","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":2},"content":[{"type":"text","text":"Top-level terms","styles":{}}],"children":[]}],"loc":6224},"6226":{"type":"rich-text","contents":[{"id":"5c88d33e-ee4b-4c55-bee6-38d46735d571","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":2},"content":[{"type":"text","text":"Patterns","styles":{}}],"children":[]}],"loc":6226},"6228":{"type":"rich-text","contents":[{"id":"ca68ce49-bdbc-4093-bd30-8f44e6a63e56","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"This is a naive method of compiling patterns to javascript, which results in a ton of nested ","styles":{}},{"type":"text","text":"if","styles":{"code":true}},{"type":"text","text":" statements.","styles":{}}],"children":[]}],"loc":6228},"6230":{"type":"rich-text","contents":[{"id":"ad3bf898-155b-490f-8f85-d745d604ff79","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"By collecting all of the ","styles":{}},{"type":"text","text":"checks","styles":{"code":true}},{"type":"text","text":" and ","styles":{}},{"type":"text","text":"assignments","styles":{"code":true}},{"type":"text","text":" produced by a deeply nested pattern, we can then produce a single if statement (if there are any checks) with a single block of assignments (if needed).","styles":{}}],"children":[]}],"loc":6230},"6232":{"type":"rich-text","contents":[{"id":"6ec71191-9ff9-452b-9f7b-85bdd1a9e11f","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":2},"content":[{"type":"text","text":"Expressions","styles":{}}],"children":[]}],"loc":6232},"6234":{"type":"rich-text","contents":[{"id":"305ab2bc-8190-423d-a01e-1dc1776028a6","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"Simple strings are compiled as \"\" normal js strings, and template strings are compiled with back-ticks.","styles":{}}],"children":[]}],"loc":6234},"6236":{"type":"string","first":6237,"templates":[{"expr":6238,"suffix":6239},{"expr":6257,"suffix":6254}],"loc":6236},"6237":{"type":"stringText","loc":6237,"text":"`"},"6238":{"type":"list","values":[6249,6252],"loc":6238},"6239":{"type":"stringText","text":"","loc":6239},"6249":{"type":"identifier","text":"fix-slashes","loc":6249},"6252":{"type":"identifier","text":"first","loc":6252},"6253":{"type":"identifier","text":"join","loc":6253},"6254":{"type":"stringText","text":"`","loc":6254},"6257":{"type":"list","values":[6253,6258,6306],"loc":6257},"6258":{"type":"string","first":6259,"templates":[],"loc":6258},"6259":{"type":"stringText","loc":6259,"text":""},"6260":{"type":"list","values":[6261,6262,6263],"loc":6260},"6261":{"type":"identifier","text":"map","loc":6261},"6262":{"type":"identifier","text":"tpls","loc":6262},"6263":{"type":"list","values":[6264,6265,6276],"loc":6263},"6264":{"type":"identifier","text":"fn","loc":6264},"6265":{"type":"array","values":[6266],"loc":6265},"6266":{"type":"list","values":[6525,6526,6527,6528],"loc":6266},"6276":{"type":"string","first":6277,"templates":[{"expr":6281,"suffix":6282},{"expr":6285,"suffix":6286}],"loc":6276},"6277":{"type":"stringText","loc":6277,"text":"${"},"6280":{"type":"comment-node","loc":6280,"contents":6279},"6281":{"type":"list","values":[6283,6284],"loc":6281},"6282":{"type":"stringText","text":"}","loc":6282},"6283":{"type":"identifier","text":"compile","loc":6283},"6284":{"type":"identifier","text":"expr","loc":6284},"6285":{"type":"list","values":[6287,6288],"loc":6285},"6286":{"type":"stringText","text":"","loc":6286},"6287":{"type":"identifier","text":"fix-slashes","loc":6287},"6288":{"type":"identifier","text":"suffix","loc":6288},"6289":{"type":"list","values":[6291,6292,6293,6295],"loc":6289},"6291":{"type":"identifier","text":"defn","loc":6291},"6292":{"type":"identifier","text":"fix-slashes","loc":6292},"6293":{"type":"array","values":[6294],"loc":6293},"6294":{"type":"identifier","text":"str","loc":6294},"6295":{"type":"list","values":[6296,6297],"loc":6295},"6296":{"type":"identifier","text":"escape-string","loc":6296},"6297":{"type":"list","values":[6298,6299],"loc":6297},"6298":{"type":"identifier","text":"unescapeString","loc":6298},"6299":{"type":"identifier","text":"str","loc":6299},"6300":{"type":"identifier","text":"first","loc":6300},"6301":{"type":"list","values":[6302,6303,6236],"loc":6301},"6302":{"type":"identifier","text":"let","loc":6302},"6303":{"type":"array","values":[6304,6260,6305],"loc":6303},"6304":{"type":"identifier","text":"tpls","loc":6304},"6305":{"type":"blank","loc":6305},"6306":{"type":"identifier","text":"tpls","loc":6306},"6307":{"type":"list","values":[5229],"loc":6307},"6308":{"type":"stringText","text":") => ","loc":6308},"6309":{"type":"identifier","text":"body","loc":6309},"6310":{"type":"stringText","text":"","loc":6310},"6311":{"type":"list","values":[6330,6313,6314,6315,6317],"loc":6311},"6313":{"type":"identifier","text":"defn","loc":6313},"6314":{"type":"identifier","text":"pat-as-arg","loc":6314},"6315":{"type":"array","values":[6316],"loc":6315},"6316":{"type":"identifier","text":"pat","loc":6316},"6317":{"type":"list","values":[6318,6328,6320,6322,6324,6327],"loc":6317},"6318":{"type":"identifier","text":"match","loc":6318},"6319":{"type":"identifier","text":"pat-as-arg-inner","loc":6319},"6320":{"type":"list","values":[6321],"loc":6320},"6321":{"type":"identifier","text":"none","loc":6321},"6322":{"type":"string","first":6323,"templates":[],"loc":6322},"6323":{"type":"stringText","loc":6323,"text":"_"},"6324":{"type":"list","values":[6325,6326],"loc":6324},"6325":{"type":"identifier","text":"some","loc":6325},"6326":{"type":"identifier","text":"arg","loc":6326},"6327":{"type":"identifier","text":"arg","loc":6327},"6328":{"type":"list","values":[6319,6329],"loc":6328},"6329":{"type":"identifier","text":"pat","loc":6329},"6330":{"type":"rich-text","contents":[{"id":"a442c0d0-4fdc-4560-bad6-9bcfdc62acc3","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"pat-as-arg","styles":{"code":true}},{"type":"text","text":" turns a pattern into a valid \"javascript l-value\", that could be on the left-hand side of an assignment, or as a function argument.","styles":{}}],"children":[]}],"loc":6330},"6331":{"type":"rich-text","contents":[{"id":"849f06b7-8fa3-4cba-b327-c3651a6fecde","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"Curried functions","styles":{}}],"children":[]}],"loc":6331},"6332":{"type":"rich-text","contents":[{"id":"0bdfdd42-5341-4997-bff2-70ef3e72639e","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"Curried application. ","styles":{}},{"type":"text","text":"(a b c) -> a(b)(c)","styles":{"code":true}}],"children":[]}],"loc":6332},"6334":{"type":"rich-text","contents":[{"id":"4840b09d-7ada-4939-ae3d-def1e301a76b","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"Let bindings are compiled as function application. This does mean we don't support recursive let bindings in this implementation. We're doing this to avoid having to reason about javascript's \"statement vs expression\" split; e.g. in our language, ","styles":{}},{"type":"text","text":"let","styles":{"code":true}},{"type":"text","text":" is an expression, whereas in javascript it's a statement. We'll get more sophisticated about this later on, when we compile to a JavaScript AST.","styles":{}}],"children":[]},{"id":"7970beb2-3794-4163-96f5-343a11219145","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"let x = y in z -> ((x) => z)(y)","styles":{"code":true}}],"children":[]}],"loc":6334},"6336":{"type":"rich-text","contents":[{"id":"9312762a-b0bb-4fcb-8834-10f053582f3c","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"Match is the most complex form to compile. ","styles":{}},{"type":"text","text":"compile-pat","styles":{"code":true}},{"type":"text","text":" produces a block of code which, if the pattern matches, will ","styles":{}},{"type":"text","text":"return","styles":{"code":true}},{"type":"text","text":". So we wrap our cases in a lambda, and call it with the ","styles":{}},{"type":"text","text":"target","styles":{"code":true}},{"type":"text","text":" of the match. If none of the cases trigger, then we throw an exception.","styles":{}}],"children":[]}],"loc":6336},"6337":{"type":"blank","loc":6337},"6338":{"type":"list","values":[6340,6341],"loc":6338},"6340":{"type":"identifier","text":"compile","loc":6340},"6341":{"type":"list","values":[6342,6344],"loc":6341},"6342":{"type":"identifier","text":"@","loc":6342},"6344":{"type":"list","values":[6345,6346,6353],"loc":6344},"6345":{"type":"identifier","text":"fn","loc":6345},"6346":{"type":"array","values":[6349],"loc":6346},"6348":{"type":"list","values":[6350,6351,6352],"loc":6348},"6349":{"type":"identifier","text":"value","loc":6349},"6350":{"type":"identifier","text":"<","loc":6350},"6351":{"type":"identifier","text":"10","loc":6351},"6352":{"type":"identifier","text":"value","loc":6352},"6353":{"type":"list","values":[6354,6348,6355,6357],"loc":6353},"6354":{"type":"identifier","text":"if","loc":6354},"6355":{"type":"string","first":6356,"templates":[],"loc":6355},"6356":{"type":"stringText","loc":6356,"text":"yes"},"6357":{"type":"string","first":6358,"templates":[],"loc":6357},"6358":{"type":"stringText","loc":6358,"text":"no"},"6359":{"type":"list","values":[6360,6361,6369],"loc":6359},"6360":{"type":"identifier","text":",","loc":6360},"6361":{"type":"list","values":[6363,6364],"loc":6361},"6362":{"type":"blank","loc":6362},"6363":{"type":"identifier","text":"@","loc":6363},"6364":{"type":"string","first":6365,"templates":[{"expr":6366,"suffix":6367}],"loc":6364},"6365":{"type":"stringText","loc":6365,"text":"${"},"6366":{"type":"string","first":6368,"templates":[],"loc":6366},"6367":{"type":"stringText","text":"","loc":6367},"6368":{"type":"stringText","loc":6368,"text":"a}"},"6369":{"type":"string","first":6370,"templates":[],"loc":6369},"6370":{"type":"stringText","text":"${a}","loc":6370},"6375":{"type":"rich-text","contents":[{"id":"43ef0bec-4416-4dbc-8063-f0bb27ea4e4b","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"Testing some weird string edge cases","styles":{}}],"children":[]}],"loc":6375},"6379":{"type":"list","values":[6381,6382,6383],"loc":6379},"6381":{"type":"identifier","text":",","loc":6381},"6382":{"type":"identifier","text":"fix-slashes","loc":6382},"6383":{"type":"array","values":[6384,6391,6397,6403],"loc":6383},"6384":{"type":"list","values":[6385,6386,6389],"loc":6384},"6385":{"type":"identifier","text":",","loc":6385},"6386":{"type":"string","first":6387,"templates":[],"loc":6386},"6387":{"type":"stringText","loc":6387,"text":"\\n"},"6388":{"type":"blank","loc":6388},"6389":{"type":"string","first":6390,"templates":[],"loc":6389},"6390":{"type":"stringText","text":"\\\\n","loc":6390},"6391":{"type":"list","values":[6392,6393,6394],"loc":6391},"6392":{"type":"identifier","text":",","loc":6392},"6393":{"type":"string","first":6395,"templates":[],"loc":6393},"6394":{"type":"string","first":6396,"templates":[],"loc":6394},"6395":{"type":"stringText","loc":6395,"text":"\\\\n"},"6396":{"type":"stringText","loc":6396,"text":"\\\\n"},"6397":{"type":"list","values":[6398,6399,6400],"loc":6397},"6398":{"type":"identifier","text":",","loc":6398},"6399":{"type":"string","first":6401,"templates":[],"loc":6399},"6400":{"type":"string","first":6402,"templates":[],"loc":6400},"6401":{"type":"stringText","loc":6401,"text":"\\\\\\n"},"6402":{"type":"stringText","loc":6402,"text":"\\\\\\\\\\\\n"},"6403":{"type":"list","values":[6404,6405,6406],"loc":6403},"6404":{"type":"identifier","text":",","loc":6404},"6405":{"type":"string","first":6407,"templates":[],"loc":6405},"6406":{"type":"string","first":6408,"templates":[],"loc":6406},"6407":{"type":"stringText","loc":6407,"text":"\\\""},"6408":{"type":"stringText","loc":6408,"text":"\\\\\\\""},"6414":{"type":"identifier","text":"int","loc":6414},"6415":{"type":"identifier","text":"_","loc":6415},"6416":{"type":"identifier","text":"int","loc":6416},"6417":{"type":"identifier","text":"_","loc":6417},"6418":{"type":"list","values":[6419,6420],"loc":6418},"6419":{"type":"identifier","text":"list","loc":6419},"6420":{"type":"list","values":[6424,6425,6426],"loc":6420},"6424":{"type":"identifier","text":",","loc":6424},"6425":{"type":"identifier","text":"string","loc":6425},"6426":{"type":"identifier","text":"int","loc":6426},"6427":{"type":"identifier","text":"_","loc":6427},"6428":{"type":"list","values":[6430,6433],"loc":6428},"6430":{"type":"identifier","text":"@!","loc":6430},"6433":{"type":"list","values":[6434,6435,6440],"loc":6433},"6434":{"type":"identifier","text":"deftype","loc":6434},"6435":{"type":"list","values":[6438,6439],"loc":6435},"6438":{"type":"identifier","text":"a","loc":6438},"6439":{"type":"identifier","text":"b","loc":6439},"6440":{"type":"list","values":[6441,6442],"loc":6440},"6441":{"type":"identifier","text":"c","loc":6441},"6442":{"type":"identifier","text":"b","loc":6442},"6443":{"type":"list","values":[6444,6445,6452],"loc":6443},"6444":{"type":"identifier","text":",","loc":6444},"6445":{"type":"list","values":[6446,6447,6449],"loc":6445},"6446":{"type":"identifier","text":"fn","loc":6446},"6447":{"type":"array","values":[6448],"loc":6447},"6448":{"type":"identifier","text":"x","loc":6448},"6449":{"type":"identifier","text":"x","loc":6449},"6450":{"type":"list","values":[6451,6428,6489],"loc":6450},"6451":{"type":"identifier","text":",","loc":6451},"6452":{"type":"array","values":[6450,6478],"loc":6452},"6453":{"type":"blank","loc":6453},"6454":{"type":"blank","loc":6454},"6478":{"type":"list","values":[6479,6480,6484],"loc":6478},"6479":{"type":"identifier","text":",","loc":6479},"6480":{"type":"list","values":[6482,6483],"loc":6480},"6481":{"type":"blank","loc":6481},"6482":{"type":"identifier","text":"@","loc":6482},"6483":{"type":"identifier","text":"x","loc":6483},"6484":{"type":"list","values":[6485,6486,6488],"loc":6484},"6485":{"type":"identifier","text":"evar","loc":6485},"6486":{"type":"string","first":6487,"templates":[],"loc":6486},"6487":{"type":"stringText","text":"x","loc":6487},"6488":{"type":"identifier","text":"6483","loc":6488},"6489":{"type":"list","values":[6490,6491,6493,6494,6500,6513],"loc":6489},"6490":{"type":"identifier","text":"tdeftype","loc":6490},"6491":{"type":"string","first":6492,"templates":[],"loc":6491},"6492":{"type":"stringText","text":"a","loc":6492},"6493":{"type":"identifier","text":"6438","loc":6493},"6494":{"type":"array","values":[6495],"loc":6494},"6495":{"type":"list","values":[6496,6497,6499],"loc":6495},"6496":{"type":"identifier","text":",","loc":6496},"6497":{"type":"string","first":6498,"templates":[],"loc":6497},"6498":{"type":"stringText","text":"b","loc":6498},"6499":{"type":"identifier","text":"6439","loc":6499},"6500":{"type":"array","values":[6501],"loc":6500},"6501":{"type":"list","values":[6502,6503,6505,6506,6512],"loc":6501},"6502":{"type":"identifier","text":",","loc":6502},"6503":{"type":"string","first":6504,"templates":[],"loc":6503},"6504":{"type":"stringText","text":"c","loc":6504},"6505":{"type":"identifier","text":"6441","loc":6505},"6506":{"type":"array","values":[6507],"loc":6506},"6507":{"type":"list","values":[6508,6509,6511],"loc":6507},"6508":{"type":"identifier","text":"tcon","loc":6508},"6509":{"type":"string","first":6510,"templates":[],"loc":6509},"6510":{"type":"stringText","text":"b","loc":6510},"6511":{"type":"identifier","text":"6442","loc":6511},"6512":{"type":"identifier","text":"6440","loc":6512},"6513":{"type":"identifier","text":"6433","loc":6513},"6514":{"type":"identifier","text":"_","loc":6514},"6515":{"type":"list","values":[6516],"loc":6515},"6516":{"type":"identifier","text":"ttypealias","loc":6516},"6518":{"type":"list","values":[6519],"loc":6518},"6519":{"type":"identifier","text":"ttypealias","loc":6519},"6520":{"type":"string","first":6521,"templates":[],"loc":6520},"6521":{"type":"stringText","loc":6521,"text":"/* type alias */"},"6524":{"type":"identifier","text":"int","loc":6524},"6525":{"type":"identifier","text":",","loc":6525},"6526":{"type":"identifier","text":"expr","loc":6526},"6527":{"type":"identifier","text":"suffix","loc":6527},"6528":{"type":"identifier","text":"_","loc":6528},"6529":{"type":"list","values":[6531,6532,6533],"loc":6529},"6531":{"type":"identifier","text":"def","loc":6531},"6532":{"type":"identifier","text":"m","loc":6532},"6533":{"type":"list","values":[6534,6535],"loc":6533},"6534":{"type":"identifier","text":"jsonify","loc":6534},"6535":{"type":"identifier","text":"1","loc":6535},"6536":{"type":"list","values":[6538,6539,6543],"loc":6536},"6538":{"type":"identifier","text":"deftype","loc":6538},"6539":{"type":"list","values":[6540,6541,6542],"loc":6539},"6540":{"type":"identifier","text":",","loc":6540},"6541":{"type":"identifier","text":"a","loc":6541},"6542":{"type":"identifier","text":"b","loc":6542},"6543":{"type":"list","values":[6544,6545,6546],"loc":6543},"6544":{"type":"identifier","text":",","loc":6544},"6545":{"type":"identifier","text":"a","loc":6545},"6546":{"type":"identifier","text":"b","loc":6546},"6547":{"type":"rich-text","contents":[{"id":"25e8a761-2297-4059-bd3f-85caf316a933","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"Packaging the code generation for the structured editor","styles":{}}],"children":[]}],"loc":6547},"6549":{"type":"rich-text","contents":[{"id":"ddded403-e32b-4baa-b0b0-d3166d3c3bd3","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"This is a peek under the hood as to how the code in these documents gets \"handed off\" to the structured editor for use as an evaluator for other documents. It's not really necessary for you to understand it, and it's disabled here in the publicly hosted editor anyway.","styles":{}}],"children":[]}],"loc":6549},"6551":{"type":"list","values":[6553,6554],"loc":6551},"6553":{"type":"identifier","text":"compile","loc":6553},"6554":{"type":"list","values":[6555,6556],"loc":6554},"6555":{"type":"identifier","text":"@","loc":6555},"6556":{"type":"identifier","text":"1","loc":6556},"6557":{"type":"identifier","text":"eval","loc":6557},"6562":{"loc":6562,"type":"rich-text","contents":[{"id":"fc77d36c-8979-4a8d-8e73-bb72705be00c","type":"heading","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left","level":2},"content":[{"type":"text","text":"Builtins","styles":{}}],"children":[]},{"id":"e4dafe2d-70cb-4696-b177-3509a76c75e5","type":"paragraph","props":{"textColor":"default","backgroundColor":"default","textAlignment":"left"},"content":[{"type":"text","text":"There are a number of primitives that we'll have implemented in JavaScript, such as arithmetic operators, low-level parsers, and some other things that will help with performance a little bit.","styles":{}}],"children":[]}]},"6564":{"type":"raw-code","lang":"javascript","raw":"function equal(a, b) {\n    if (a === b) return true;\n\n    if (a && b && typeof a == 'object' && typeof b == 'object') {\n        var length, i, keys;\n        if (Array.isArray(a)) {\n            length = a.length;\n            if (length != b.length) return false;\n            for (i = length; i-- !== 0; ) if (!equal(a[i], b[i])) return false;\n            return true;\n        }\n\n        keys = Object.keys(a);\n        length = keys.length;\n        if (length !== Object.keys(b).length) return false;\n\n        for (i = length; i-- !== 0; ) {\n            if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n        }\n\n        for (i = length; i-- !== 0; ) {\n            var key = keys[i];\n\n            if (!equal(a[key], b[key])) return false;\n        }\n\n        return true;\n    }\n\n    // true if both NaN, false otherwise\n    return a !== a && b !== b;\n}\n\nfunction unescapeString(n) {\n    if (n == null || !n.replaceAll) {\n        debugger;\n        return '';\n    }\n    return n.replaceAll(/\\\\\\\\./g, (m) => {\n        if (m[1] === 'n') {\n            return '\\\\n';\n        }\n        if (m[1] === 't') {\n            return '\\\\t';\n        }\n        if (m[1] === 'r') {\n            return '\\\\r';\n        }\n        return m[1];\n    });\n}\n\nfunction unwrapList(v) {\n  const res = [];\n  for (;v.type !== 'nil';v=v[1]) {\n    res.push(v[0]);\n  }\n  return res;\n}\n\nfunction wrapList(v) {\n    let res = { type: 'nil' };\n    for (let i = v.length - 1; i >= 0; i--) {\n        res = { type: 'cons', 0: v[i], 1: res };\n    }\n    return res;\n}\n\nconst sanMap = {\n    // '$$$$' gets interpreted by replaceAll as '$$', for reasons\n    $: '$$$$',\n    '-': '_',\n    '+': '$pl',\n    '*': '$ti',\n    '=': '$eq',\n    '>': '$gt',\n    '<': '$lt',\n    \"'\": '$qu',\n    '\"': '$dq',\n    ',': '$co',\n    '/': '$sl',\n    ';': '$semi',\n    '@': '$at',\n    ':': '$cl',\n    '#': '$ha',\n    '!': '$ex',\n    '|': '$bar',\n    '()': '$unit',\n    '?': '$qe',\n  };\nconst kwds =\n    'case new var const let if else return super break while for default eval'.split(' ');\n\n// Convert an identifier into a valid js identifier, replacing special characters, and accounting for keywords.\nfunction sanitize(raw) {\n    for (let [key, val] of Object.entries(sanMap)) {\n        raw = raw.replaceAll(key, val);\n    }\n    if (kwds.includes(raw)) return '$' + raw\n    return raw\n}\n\nconst valueToString = (v) => {\n    if (Array.isArray(v)) {\n        return `[${v.map(valueToString).join(', ')}]`;\n    }\n    if (typeof v === 'object' && v && 'type' in v) {\n        if (v.type === 'cons' || v.type === 'nil') {\n            const un = unwrapList(v);\n            return '[' + un.map(valueToString).join(' ') + ']';\n        }\n\n        let args = [];\n        for (let i = 0; i in v; i++) {\n            args.push(v[i]);\n        }\n        return `(${v.type}${args\n            .map((arg) => ' ' + valueToString(arg))\n            .join('')})`;\n    }\n    if (typeof v === 'string') {\n        if (v.includes('\"') && !v.includes(\"'\")) {\n            return (\n                \"'\" + JSON.stringify(v).slice(1, -1).replace(/\\\\\"/g, '\"') + \"'\"\n            );\n        }\n        return JSON.stringify(v);\n    }\n    if (typeof v === 'function') {\n        return '<function>';\n    }\n\n    return '' + v;\n};\n\nreturn {\n    '+': (a) => (b) => a + b,\n    '-': (a) => (b) => a - b,\n    '<': (a) => (b) => a < b,\n    '<=': (a) => (b) => a <= b,\n    '>': (a) => (b) => a > b,\n    '>=': (a) => (b) => a >= b,\n    '=': (a) => (b) => equal(a, b),\n    '!=': (a) => (b) => !equal(a, b),\n    pi: Math.PI,\n    'replace-all': a => b => c => a.replaceAll(b, c),\n    eval: source => {\n      return new Function('', 'return ' + source)();\n    },\n    'eval-with': ctx => source => {\n      const args = '{' + Object.keys(ctx).join(',') + '}'\n      return new Function(args, 'return ' + source)(ctx);\n    },\n    $unit: null,\n    errorToString: f => arg => {\n      try {\n        return f(arg)\n      } catch (err) {\n        return err.message;\n      }\n    },\n    valueToString,\n    unescapeString,\n    sanitize,\n    equal: a => b => equal(a, b),\n    'int-to-string': (a) => a.toString(),\n    'float-to-string': a => a.toString(),\n    'string-to-int': (a) => {\n        const v = Number(a);\n        return Number.isInteger(v) && v.toString() === a ? { type: 'some', 0: v } : { type: 'none' };\n    },\n    'string-to-float': (a) => {\n        const v = Number(a);\n        return Number.isFinite(v) ? { type: 'some', 0: v } : { type: 'none' };\n    },\n\n    // maps\n    'map/nil': [],\n    'map/set': (map) => (key) => (value) =>\n        [[key, value], ...map.filter((i) => i[0] !== key)],\n    'map/rm': (map) => (key) => map.filter((i) => !equal(i[0], key)),\n    'map/get': (map) => (key) => {\n        const found = map.find((i) => equal(i[0], key));\n        return found ? { type: 'some', 0: found[1] } : { type: 'none' };\n    },\n    'map/map': (fn) => (map) => map.map(([k, v]) => [k, fn(v)]),\n    'map/merge': (one) => (two) =>\n        [...one, ...two.filter(([key]) => !one.find(([a]) => equal(a, key)))],\n    'map/values': (map) => wrapList(map.map((item) => item[1])),\n    'map/keys': (map) => wrapList(map.map((item) => item[0])),\n    'map/from-list': (list) =>\n        unwrapList(list).map((pair) => [pair[0], pair[1]]),\n    'map/to-list': (map) =>\n        wrapList(map.map(([key, value]) => ({ type: ',', 0: key, 1: value }))),\n\n    // sets\n    'set/nil': [],\n    'set/add': (s) => (v) => [v, ...s.filter((m) => !equal(v, m))],\n    'set/has': (s) => (v) => s.includes(v),\n    'set/rm': (s) => (v) => s.filter((i) => !equal(i, v)),\n    // NOTE this is only working for primitives\n    'set/diff': (a) => (b) => a.filter((i) => !b.some((j) => equal(i, j))),\n    'set/merge': (a) => (b) =>\n        [...a, ...b.filter((x) => !a.some((y) => equal(y, x)))],\n    'set/overlap': (a) => (b) => a.filter((x) => b.some((y) => equal(y, x))),\n    'set/to-list': wrapList,\n    'set/from-list': (s) => {\n        const res = [];\n        unwrapList(s).forEach((item) => {\n            if (res.some((m) => equal(item, m))) {\n                return;\n            }\n            res.push(item);\n        });\n        return res;\n    },\n\n    // Various debugging stuff\n    jsonify: (v) => JSON.stringify(v) ?? 'undefined',\n    fatal: (message) => {\n        throw new Error(`Fatal runtime: ${message}`);\n    },\n}","loc":6564},"6565":{"type":"list","values":[6566,6567,6564],"loc":6565},"6566":{"type":"identifier","text":"def","loc":6566},"6567":{"type":"identifier","text":"builtins","loc":6567},"6568":{"type":"list","values":[6575],"loc":6568},"6570":{"type":"blank","loc":6570},"6572":{"type":"list","values":[6573,6599],"loc":6572},"6573":{"type":"identifier","text":"eval","loc":6573},"6574":{"type":"identifier","text":"builtins","loc":6574},"6575":{"type":"list","values":[6576,6577,6572,6588],"loc":6575},"6576":{"type":"identifier","text":"eval","loc":6576},"6577":{"type":"raw-code","lang":"javascript","raw":"builtins => sanitize => {\n  const san = {}\n  Object.keys(builtins).forEach(k => san[sanitize(k)] = builtins[k])\n  return san\n}","loc":6577},"6582":{"type":"list","values":[6584,6585,6587],"loc":6582},"6584":{"type":"identifier","text":"eval","loc":6584},"6585":{"type":"string","first":6586,"templates":[],"loc":6585},"6586":{"type":"stringText","loc":6586,"text":"x => x + 2"},"6587":{"type":"identifier","text":"210","loc":6587},"6588":{"type":"identifier","text":"sanitize","loc":6588},"6591":{"type":"list","values":[6592,6593,6568],"loc":6591},"6592":{"type":"identifier","text":"def","loc":6592},"6593":{"type":"identifier","text":"builtins-for-eval","loc":6593},"6594":{"type":"list","values":[6596,6597,6598],"loc":6594},"6596":{"type":"identifier","text":"def","loc":6596},"6597":{"type":"identifier","text":"eval-with-builtins","loc":6597},"6598":{"type":"list","values":[6603,6604],"loc":6598},"6599":{"type":"string","first":6600,"templates":[{"expr":6574,"suffix":6601}],"loc":6599},"6600":{"type":"stringText","loc":6600,"text":"(() => {"},"6601":{"type":"stringText","loc":6601,"text":"})()"},"6603":{"type":"identifier","text":"eval-with","loc":6603},"6604":{"type":"identifier","text":"builtins-for-eval","loc":6604},"6605":{"type":"list","values":[6607,6608],"loc":6605},"6607":{"type":"identifier","text":"eval-with-builtins","loc":6607},"6608":{"type":"string","first":6609,"templates":[],"loc":6608},"6609":{"type":"stringText","loc":6609,"text":"$pl(1)(3)"},"6610":{"type":"identifier","text":"builtins","loc":6610},"-1":{"type":"list","loc":-1,"values":[403,3442,3450,2848,3432,3438,3428,590,408,529,541,555,568,2008,2248,2402,2312,2658,2726,2368,2790,2746,2112,2114,2128,2080,2836,2840,2844,3118,3200,638,772,813,2864,2930,3306,3358,3072,828,2006,3218,3230,3052]}},"cards":[{"path":[],"top":3465}],"nsMap":{"3465":{"type":"normal","top":-1,"children":[5396,5398,3523,3515,6225,6088,6227,6233,6561,6548],"id":3465},"3477":{"type":"normal","top":590,"children":[],"id":3477,"collapsed":false},"3479":{"type":"normal","top":529,"children":[],"id":3479},"3480":{"type":"normal","top":541,"children":[],"id":3480},"3481":{"type":"normal","top":555,"children":[],"id":3481},"3482":{"type":"normal","top":568,"children":[],"id":3482},"3483":{"type":"normal","top":2008,"children":[],"id":3483},"3484":{"type":"normal","top":2248,"children":[],"id":3484},"3485":{"type":"normal","top":2402,"children":[],"id":3485},"3486":{"type":"normal","top":2312,"children":[],"id":3486},"3487":{"type":"normal","top":2658,"children":[],"id":3487,"collapsed":false},"3499":{"type":"normal","top":3118,"children":[6048],"id":3499,"collapsed":false},"3501":{"type":"normal","top":638,"children":[],"id":3501,"collapsed":false},"3504":{"type":"normal","top":2864,"children":[3505],"id":3504},"3505":{"type":"normal","top":2930,"children":[],"id":3505},"3506":{"type":"normal","top":3306,"children":[],"id":3506},"3509":{"type":"normal","top":828,"children":[6339,6552,6558,3570],"id":3509,"collapsed":false},"3515":{"type":"normal","top":3514,"children":[5400,4721,4807,4820,3479,3480,3481,3482],"id":3515,"collapsed":true},"3523":{"type":"normal","top":3522,"id":3523,"children":[3483,3484,3485,3486,3487,3477,6537,5738,5493,6037],"collapsed":true},"3540":{"type":"normal","top":3539,"id":3540,"children":[3504,3506,6290,6380],"collapsed":false},"3570":{"type":"normal","top":3569,"id":3570,"children":[],"collapsed":false,"plugin":{"id":"fixture","options":null}},"4078":{"type":"normal","top":4714,"children":[],"id":4078,"plugin":{"id":"evaluator","options":"self-1.js"},"collapsed":false},"4080":{"type":"normal","top":4079,"id":4080,"children":[],"collapsed":false},"4252":{"type":"normal","top":4251,"id":4252,"children":[]},"4708":{"type":"normal","top":4707,"id":4708,"children":[],"collapsed":false},"4721":{"type":"normal","top":4720,"children":[],"id":4721},"4807":{"type":"normal","children":[],"id":4807,"top":4789},"4820":{"type":"normal","top":4819,"children":[],"id":4820},"4927":{"type":"normal","top":4926,"children":[5578,6530],"id":4927},"5117":{"type":"normal","top":5116,"id":5117,"children":[]},"5134":{"type":"normal","top":5133,"children":[],"id":5134},"5156":{"type":"normal","top":5155,"children":[5117,5134],"id":5156,"collapsed":true},"5306":{"type":"normal","top":5305,"children":[],"id":5306},"5394":{"children":[],"top":5389,"id":5394,"type":"normal"},"5396":{"type":"normal","top":5395,"id":5396,"children":[]},"5398":{"type":"normal","top":5397,"children":[],"id":5398},"5400":{"type":"normal","top":5399,"id":5400,"children":[]},"5493":{"type":"normal","top":5492,"id":5493,"children":[]},"5578":{"type":"normal","top":5577,"children":[],"id":5578,"plugin":{"id":"fixture","options":null}},"5661":{"type":"normal","top":5660,"children":[6090],"id":5661},"5738":{"type":"normal","top":5737,"children":[],"id":5738},"5807":{"type":"normal","top":5806,"children":[],"id":5807},"5963":{"type":"normal","top":5962,"children":[6165],"id":5963},"6037":{"type":"normal","top":6036,"children":[],"id":6037},"6048":{"type":"normal","top":6047,"children":[],"id":6048,"plugin":{"id":"fixture","options":null}},"6088":{"type":"normal","top":6087,"id":6088,"children":[6229,4080,4252],"collapsed":true},"6090":{"type":"normal","top":6089,"children":[],"id":6090,"plugin":{"id":"fixture","options":null}},"6165":{"type":"normal","top":6164,"children":[],"id":6165,"collapsed":false,"plugin":{"id":"fixture","options":null}},"6225":{"type":"normal","top":6224,"children":[3501,3499],"id":6225,"collapsed":true},"6227":{"type":"normal","top":6226,"children":[6231,5661,5807,5963,6312,4927],"id":6227,"collapsed":true},"6229":{"type":"normal","top":6228,"id":6229,"children":[]},"6231":{"type":"normal","top":6230,"id":6231,"children":[]},"6233":{"type":"normal","top":6232,"children":[3540,5156,6429,5306,5394,3509],"id":6233,"collapsed":true},"6290":{"type":"normal","top":6289,"children":[],"id":6290},"6312":{"type":"normal","top":6311,"children":[],"id":6312},"6339":{"type":"normal","top":6338,"id":6339,"children":[],"display":{"id":"pre","options":null},"collapsed":"pinned"},"6380":{"type":"normal","top":6379,"children":[],"id":6380,"plugin":{"id":"fixture","options":null}},"6429":{"type":"normal","top":6443,"children":[],"id":6429,"plugin":{"id":"fixture","options":null}},"6530":{"type":"normal","top":6529,"children":[],"id":6530},"6537":{"type":"normal","top":6536,"children":[],"id":6537},"6548":{"type":"normal","top":6547,"id":6548,"children":[6550,4078],"collapsed":false},"6550":{"type":"normal","top":6549,"id":6550,"children":[]},"6552":{"type":"normal","top":6551,"children":[],"id":6552},"6558":{"type":"normal","top":6557,"children":[],"id":6558},"6561":{"type":"normal","id":6561,"top":6562,"children":[6569,6595,6606,6583,6563],"collapsed":false},"6563":{"type":"normal","id":6563,"top":6565,"children":[],"collapsed":true},"6569":{"type":"normal","top":6591,"id":6569,"children":[]},"6583":{"type":"normal","top":6582,"children":[],"id":6583},"6595":{"type":"normal","top":6594,"children":[],"id":6595},"6606":{"type":"normal","top":6605,"children":[],"id":6606}},"evaluator":["self-1.js","jcst.js","parse-self.js"],"meta":{},"highlight":[]}